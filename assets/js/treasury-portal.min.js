const EMBED_ORIGIN="https://realtreasury.com";let treasuryTechPortal;const portalRoot=document.querySelector(".treasury-portal")||document.body;function postHeight(){if(window.parent!==window){const e=Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.body.scrollHeight,document.body.offsetHeight,window.innerHeight);window.parent.postMessage({type:"treasury-height",height:e+100},"*");try{window.parent.postMessage({type:"treasury-height",height:e+100},EMBED_ORIGIN)}catch(e){}}}function debounce(e,t){let o;return function(){clearTimeout(o),o=setTimeout(e,t)}}const debouncedPostHeight=debounce(postHeight,100);window.addEventListener("load",()=>{setTimeout(postHeight,100),setTimeout(postHeight,500),setTimeout(postHeight,1e3)}),window.addEventListener("resize",debouncedPostHeight),new ResizeObserver(()=>{debouncedPostHeight()}).observe(portalRoot),new MutationObserver(()=>{debouncedPostHeight()}).observe(portalRoot,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),document.addEventListener("DOMContentLoaded",()=>{treasuryTechPortal=new TreasuryTechPortal,setTimeout(()=>{"function"==typeof postHeight&&postHeight()},1500),window.addEventListener("resize",()=>{window.innerWidth<=768?(treasuryTechPortal.sideMenuOpen&&treasuryTechPortal.closeSideMenu(),treasuryTechPortal.shortlistMenuOpen&&treasuryTechPortal.closeShortlistMenu()):treasuryTechPortal.renderShortlist(),setTimeout(()=>{"function"==typeof postHeight&&postHeight()},200)});const e=document.querySelectorAll(".rt-nav-item"),t=window.treasuryTechPortal;e.forEach(e=>{e.addEventListener("click",function(){t&&(t.sideMenuOpen&&t.closeSideMenu(),t.shortlistMenuOpen&&t.closeShortlistMenu())})}),document.addEventListener("click",function(e){(e.target.closest(".external-menu-toggle")||e.target.closest(".external-shortlist-toggle"))&&document.querySelectorAll(".rt-nav-item.active").forEach(e=>{e.classList.remove("active")})})});class TreasuryTechPortal{constructor(){this.TREASURY_TOOLS=[{name:"Kyriba",category:"TRMS",desc:"Market-leading cloud treasury platform serving 3,000+ global clients with AI-powered cash forecasting, comprehensive risk management, and advanced derivatives trading capabilities.",features:["AI-driven cash forecasting","Real-time risk analytics","Derivatives management","Multi-bank connectivity","Regulatory compliance","Hedge accounting automation"],target:"Large enterprises and multinational corporations with complex treasury operations",videoUrl:"https://realtreasury.com/kyriba-06-2025/?embed=1",websiteUrl:"https://www.kyriba.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Kyriba.png"},{name:"GTreasury",category:"TRMS",desc:"Enterprise treasury platform known for deep ERP integration, advanced reporting, and sophisticated multi-entity consolidation for complex organizational structures.",features:["Deep ERP integration","Multi-entity consolidation","Advanced analytics","Customizable workflows","Real-time reporting","API connectivity"],target:"Fortune 500 companies requiring complex consolidation and reporting",videoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/GTreasury-06-2025.mp4",websiteUrl:"https://gtreasury.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/GTreasury.png"},{name:"Reval",category:"TRMS",desc:"Comprehensive treasury and risk platform owned by ION Group, specializing in sophisticated derivatives valuation, hedge accounting, and regulatory reporting.",features:["Derivatives valuation","Hedge accounting","Market data integration","Risk analytics","Regulatory reporting","Trade capture"],target:"Financial institutions and corporations with complex derivative portfolios",videoUrl:"",websiteUrl:"https://iongroup.com/products/treasury/reval/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/Reval.png"},{name:"Quantum",category:"TRMS",desc:"Advanced treasury management system with real-time risk analytics, portfolio optimization, and sophisticated hedging strategies for financial institutions.",features:["Real-time risk monitoring","Portfolio optimization","Stress testing","Automated hedging","Compliance controls","Advanced analytics"],target:"Investment banks and large financial institutions",videoUrl:"",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/FIS.png"},{name:"WallStreet Suite",category:"TRMS",desc:"Complete treasury and risk platform with multi-asset support, advanced analytics, and comprehensive regulatory reporting for complex financial operations.",features:["Multi-asset support","Advanced analytics","Regulatory compliance","Trade management","Risk controls","Market data feeds"],target:"Large banks and corporations requiring full-scale treasury operations",videoUrl:"",websiteUrl:"https://iongroup.com/products/treasury/wallstreet-suite/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/Wallstreet-Suite.png"},{name:"ATOM",category:"TRMS",desc:"Enterprise treasury platform focused on derivatives trading, risk management, and automated workflow processing for sophisticated financial operations.",features:["Derivatives trading","Automated workflows","Risk management","Trade processing","Compliance monitoring","Real-time analytics"],target:"Large corporations and financial institutions with active trading operations",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/ATOM-TM.png"},{name:"Integrity",category:"TRMS",desc:"Enterprise treasury solution emphasizing governance, compliance, and audit trails for highly regulated financial environments and complex organizational structures.",features:["Governance controls","Audit trails","Compliance management","Policy enforcement","Risk controls","Workflow approval"],target:"Highly regulated industries requiring strict governance and compliance",videoUrl:"",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/FIS.png"},{name:"IT2",category:"TRMS",desc:"Integrated treasury technology platform combining cash management, risk analytics, and payment processing in a unified enterprise solution.",features:["Integrated platform","Cash management","Risk analytics","Payment processing","Bank connectivity","Unified reporting"],target:"Large enterprises seeking integrated treasury technology solutions",videoUrl:"",websiteUrl:"https://iongroup.com/products/treasury/it2/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/IT2-navy.svg"},{name:"Datalog",category:"TRMS",desc:"Treasury management system with powerful analytics engine, multi-entity support, and comprehensive reporting capabilities for complex treasury operations.",features:["Advanced analytics","Multi-entity support","Data visualization","Custom reporting","Cash positioning","Risk monitoring"],target:"Large corporations requiring sophisticated analytics and reporting",videoUrl:"",websiteUrl:"https://www.datalog-finance.com/en/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Datalog-logo.png"},{name:"Coupa",category:"TRMS",desc:"Business spend management platform with integrated treasury operations, procurement workflows, and comprehensive spend analytics for enterprise organizations.",features:["Spend management","Treasury integration","Procurement workflows","Supplier management","Analytics dashboard","Automation tools"],target:"Large enterprises requiring integrated spend and treasury management",videoUrl:"",websiteUrl:"https://www.coupa.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Coupa.png"},{name:"Treasury Cube",category:"TRMS",desc:"Modular treasury platform with customizable features and scalable architecture that grows with your business needs and treasury complexity.",features:["Modular design","Customizable features","Scalable architecture","Growth-focused","Flexible pricing","Configurable workflows"],target:"Growing companies requiring scalable and customizable treasury solutions",videoUrl:"https://realtreasury.com/wp-content/uploads/2025/08/Treasury-Cube-08-2025.mp4",websiteUrl:"https://treasurycube.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Treasury-Cube.png"},{name:"Openlink",category:"TRMS",desc:"Integrated trading, treasury, and risk management platform for energy and commodity businesses, providing real-time analytics and comprehensive compliance controls.",features:["Commodity trading","Treasury management","Derivatives valuation","Risk analytics","Hedge management","Regulatory compliance"],target:"Energy and commodity firms plus large corporates with complex trading and treasury operations",websiteUrl:"https://iongroup.com/products/treasury/openlink/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/Openlink-navy.svg"},{name:"Trovata",category:"CASH",desc:"AI-powered cash management platform providing real-time bank connectivity, predictive forecasting, and intelligent cash visibility for modern finance teams.",features:["AI forecasting","Real-time connectivity","Predictive analytics","Cash visibility","Mobile access","API integration"],target:"Mid to large companies seeking AI-driven cash management solutions",videoUrl:"",websiteUrl:"https://trovata.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Trovata.png"},{name:"Tesorio",category:"CASH",desc:"Machine learning-powered cash flow optimization platform that automates forecasting, scenario planning, and cash management workflows.",features:["ML optimization","Automated forecasting","Scenario planning","Workflow automation","Integration tools","Performance analytics"],target:"Growth companies and mid-market businesses optimizing cash flow",websiteUrl:"https://www.tesorio.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Tesorio.jpg"},{name:"Autocash",category:"CASH",desc:"AI-first cash management solution with predictive analytics, automated scenario modeling, and intelligent cash optimization recommendations.",features:["AI predictions","Automated scenarios","Smart recommendations","Risk assessment","Cash optimization","Intelligent alerts"],target:"Tech-forward companies embracing AI-driven financial operations",videoUrl:"",websiteUrl:"https://www.autocash.ai/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/AutoCash.png"},{name:"Balance",category:"CASH",desc:"Real-time cash visibility platform with automated bank reconciliation, multi-currency support, and streamlined cash positioning capabilities.",features:["Real-time visibility","Auto reconciliation","Multi-currency","Cash positioning","Bank connectivity","Streamlined UX"],target:"Companies needing real-time cash visibility and automated reconciliation",websiteUrl:"https://www.balancecash.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Balance-Cash.jpg"},{name:"Nilus",category:"CASH",desc:"Advanced cash forecasting platform with sophisticated scenario planning, variance analysis, and performance tracking for precise liquidity management.",features:["Advanced forecasting","Scenario planning","Variance analysis","Performance tracking","Budget integration","Precision modeling"],target:"Companies requiring sophisticated cash forecasting and scenario analysis",videoUrl:"",websiteUrl:"https://www.nilus.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Nilus.png"},{name:"Obol",category:"CASH",desc:"Digital treasury platform focused on liquidity optimization, real-time cash visibility, and modern workflow automation for finance teams.",features:["Liquidity optimization","Digital workflows","Real-time data","Modern interface","Mobile platform","Automated reporting"],target:"Modern finance teams seeking digital-first cash management solutions",videoUrl:"",websiteUrl:"https://www.obol.app/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Obol.png"},{name:"Panax",category:"CASH",desc:"Working capital optimization platform specializing in payment timing analytics, A/R and A/P integration, and cash flow enhancement strategies.",features:["Working capital optimization","Payment timing analytics","A/R & A/P integration","Cash flow enhancement","Performance tracking","Optimization tools"],target:"Companies focused on working capital optimization and payment timing",videoUrl:"",websiteUrl:"https://www.thepanax.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Panax.png"},{name:"Statement",category:"CASH",desc:"Automated bank statement processing platform with intelligent data extraction, reconciliation tools, and seamless integration capabilities.",features:["Automated processing","Data extraction","Reconciliation tools","Data validation","Exception handling","API integration"],target:"Companies seeking automated bank statement processing and data extraction",websiteUrl:"https://www.statement.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Statement.png"},{name:"Treasury Suite",category:"CASH",desc:"Comprehensive cash management suite combining forecasting, positioning, liquidity optimization, and workflow management in an integrated platform.",features:["Comprehensive suite","Cash forecasting","Liquidity optimization","Workflow management","Bank connectivity","Integrated platform"],target:"Companies requiring a complete cash management suite with integrated functionality",websiteUrl:"https://www.treasurysuite.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Treasury-Suite-Logo-PNG.png"},{name:"Vesto",category:"CASH",desc:"Cash positioning platform offering multibank cash flow monitoring and liquidity management capabilities.",features:["Yield optimization","Risk monitoring","Investment tracking","Liquidity management","Performance analytics","Compliance tools"],target:"Companies with significant cash positions seeking yield optimization",videoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Vesto-06-2025.mp4",websiteUrl:"https://www.vesto.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/08/Vesto.webp"},{name:"Treasura",category:"LITE",desc:"User-friendly treasury management system offering essential cash and risk management features with simplified implementation and competitive pricing.",features:["User-friendly","Essential features","Simplified setup","Competitive pricing","Basic reporting","Standard integrations"],target:"Mid-market companies seeking accessible treasury management solutions",videoUrl:"",websiteUrl:"https://iongroup.com/products/treasury/treasura/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/Treasura.png"},{name:"Treasury Curve",category:"LITE",desc:"Simplified treasury management solution focusing on core functionality with intuitive interface and streamlined user experience.",features:["Simplified interface","Core functionality","Easy setup","Streamlined UX","Basic reporting","Cost-effective"],target:"Companies seeking simplified treasury management with core functionality",videoUrl:"",websiteUrl:"https://www.treasurycurve.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Treasury-Curve.png"},{name:"Bottomline",category:"LITE",desc:"Payment automation and cash management platform with strong banking integration, fraud protection, and multi-bank connectivity.",features:["Payment automation","Fraud protection","Banking integration","Multi-bank support","Security controls","Workflow tools"],target:"Companies prioritizing payment automation and banking integration",websiteUrl:"https://www.bottomline.com/us?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/bottomline-technologies-logo.png"},{name:"City Financials",category:"LITE",desc:"Treasury system specifically designed for mid-market companies with growth-oriented features, quick implementation, and scalable pricing.",features:["Mid-market focus","Growth-oriented","Quick implementation","Scalable pricing","Support included","Practical features"],target:"Mid-market companies seeking practical and growth-oriented solutions",videoUrl:"",websiteUrl:"https://iongroup.com/products/treasury/city-financials/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/City-Financials-navy.svg"},{name:"HighRadius",category:"LITE",desc:"Autonomous finance platform combining AI-powered accounts receivable optimization with treasury management for integrated financial operations.",features:["AI automation","A/R optimization","Treasury integration","Machine learning","Process automation","Autonomous finance"],target:"Companies seeking AI-powered automation for A/R and treasury operations",videoUrl:"",websiteUrl:"https://www.highradius.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/High-Radius.png"},{name:"Treasury4",category:"LITE",desc:"Next-generation treasury platform with modern UI/UX, cloud-native architecture, and intuitive workflows designed for the modern finance professional.",features:["Modern UI/UX","Cloud-native","Intuitive workflows","API-first design","Mobile responsive","Quick deployment"],target:"Modern finance teams seeking next-generation treasury technology",videoUrl:"https://realtreasury.com/wp-content/uploads/2025/07/Treasury4-06-2025.mp4",websiteUrl:"https://www.treasury4.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",logoUrl:"https://realtreasury.com/wp-content/uploads/2025/06/Treasury4Logo-GraphiteGreen.png"}],this.CATEGORY_INFO={CASH:{name:"Cash Tools",badge:"Essential",description:"Cash Tools are the essential first step for treasury teams moving away from manual spreadsheets. These platforms provide a single, unified view of bank balances and transactions through direct bank connections (via API or files). They excel at providing clear, real-time cash visibility and basic forecasting, allowing businesses to understand their current cash position and anticipate future needs without the complexity of a full TRMS.",features:["Bank Connectivity (API, SFTP)","Basic Forecasting Tools","Cash Visibility","Transaction Search, Sort, Tag, Group"],videoUrl:"https://realtreasury.com/wp-content/uploads/2025/08/Cash-Tools-Intro.mp4",videoPoster:"https://realtreasury.com/wp-content/uploads/2025/08/Cash-Tools-Intro.png"},LITE:{name:"Treasury Management System Lite (TMS-Lite)",badge:"Scalable",description:"TMS-Lite solutions bridge the gap between basic Cash Tools and enterprise TRMS platforms. They build upon cash visibility by adding crucial treasury functions like multi-currency cash positioning, initiating treasury payments (wires, transfers), and managing basic financial instruments like foreign exchange contracts. These systems are ideal for growing companies whose needs have outpaced simple cash tools but do not yet require the full complexity of an enterprise system.",features:["Bank Connectivity (API, SFTP)","Basic Forecasting Tools","Cash Visibility","Transaction Search, Sort, Tag, Group","Cash Positioning","Market Data","Treasury Payments (API, SFTP)"],videoUrl:"https://realtreasury.com/wp-content/uploads/2025/08/TMS-Lite-Intro.mp4",videoPoster:"https://realtreasury.com/wp-content/uploads/2025/08/TMS-Lite-Intro.png"},TRMS:{name:"Treasury & Risk Management Systems (TRMS)",badge:"Advanced",description:"Treasury & Risk Management Systems (TRMS) are comprehensive platforms for large, complex organizations. They offer a broad suite of tightly integrated modules far beyond cash visibility, covering debt and investment management, advanced financial risk analysis (FX, interest rates, commodities), hedge accounting, global payments, and in-house banking. These systems are designed to centralize and automate sophisticated treasury workflows.",features:["Bank Connectivity (API, SFTP)","Basic Forecasting Tools","Cash Visibility","Transaction Search, Sort, Tag, Group","Cash Positioning","Market Data","Treasury Payments (API, SFTP)","Derivatives (Interest, FX)","Intercompany Loans","Instrument Valuations","AI Forecasting","AI Insights","AP Payments","Bank Account Management","Basic FX (Spots, FWD)","Cash Accounting","Debt Management","Deal Accounting","In-House Banking","Investments","SWIFT Connectivity"],videoUrl:"https://realtreasury.com/wp-content/uploads/2025/08/TRMS-Intro.mp4",videoPoster:"https://realtreasury.com/wp-content/uploads/2025/08/TRMS-Intro.png"}};const e=["Bank Connectivity","Basic Forecasting Tools","Cash Visibility","Transaction Search, Sort, Tag, Group"],t=[...e,"Cash Positioning","Market Data","Treasury Payments"],o=[...t,"AI Forecasting","AI Insights","AP Payments","Bank Account Management","Basic FX (Spots, FWD)","Cash Accounting","Debt Management","Deal Accounting","In-House Banking","Investments","SWIFT Connectivity","Derivatives (Interest, FX)","Intercompany Loans","Instrument Valuations"];this.CATEGORY_TAGS={CASH:e,LITE:t,TRMS:o},this.currentFilter="ALL",this.searchTerm="",this.filteredTools=[],this.allTags=[],this.advancedFilters={features:[],hasVideo:!1},this.currentSort="name",this.currentView="grid",this.groupByCategory=!0,this.sideMenuOpen=!1,this.shortlist=[],this.shortlistMenuOpen=!1,this.touchDragTool=null,this.previousFocusedElement=null,this.videoTimes={},this.currentToolId=null,this.permanentToolPickerInitialized=!1,this.spaceHandler=null,this.handleOutsideSideMenuClick=e=>{const t=document.getElementById("sideMenu"),o=document.getElementById("sideMenuToggle"),n=document.getElementById("externalMenuToggle");!t||t.contains(e.target)||o?.contains(e.target)||n?.contains(e.target)||(e.stopPropagation(),this.closeSideMenu())},this.handleOutsideShortlistMenuClick=e=>{const t=document.getElementById("shortlistMenu"),o=document.getElementById("shortlistMenuToggle"),n=document.getElementById("externalShortlistToggle");!t||t.contains(e.target)||o?.contains(e.target)||n?.contains(e.target)||this.closeShortlistMenu()},this.TREASURY_TOOLS=[],this.loadVendorTools(),this.swipeStart=null,this.swipeThreshold=100,this.swipeVelocityThreshold=.3,window.addEventListener("message",e=>{if(e.origin.includes("youtube.com")&&"string"==typeof e.data)try{const t=JSON.parse(e.data);if("infoDelivery"===t.event&&"number"==typeof t.info&&t.id){const e=t.id.replace(/^yt-/,"");this.videoTimes[e]=t.info}}catch(e){}})}isMobile(){return window.matchMedia("(max-width: 768px)").matches}handleResponsive(){const e=this.isMobile();if(document.querySelectorAll(".tool-card").forEach(t=>{t.draggable=!e}),e){this.closeSideMenu(),this.closeShortlistMenu();const e=document.getElementById("externalMenuToggle"),t=document.getElementById("externalShortlistToggle");e&&(e.style.display="none"),t&&(t.style.display="none");const o=document.getElementById("bottomNav");o&&(o.style.display="flex")}else{const e=document.getElementById("externalMenuToggle"),t=document.getElementById("externalShortlistToggle");e&&(e.style.display="flex"),t&&(t.style.display="flex");const o=document.getElementById("bottomNav");o&&(o.style.display="none")}this.applyViewStyles()}normalizeCategory(e,t){const o=(e||t||"").toUpperCase();return o.includes("TRM")?"TRMS":o.includes("LITE")?"LITE":o.includes("CASH")?"CASH":""}mapVendorRecord(e){const{name:t="",description:o="",parent_category:n="",category:s="",subcategories:a=[],region:i="",video_url:r="",website_url:l="",logo_url:c="",target_market:d="",features:u=[]}=e||{},m=Array.isArray(a)?a:a?[a]:[];return{name:t,desc:o,category:this.normalizeCategory(n,s),parentCategory:n,subCategories:m,region:i,features:u,target:d,videoUrl:r,websiteUrl:l,logoUrl:c}}async loadVendorTools(){try{const e=await fetch(TTP_DATA.rest_url),t=await e.json();this.TREASURY_TOOLS=t.map(e=>this.mapVendorRecord(e))}catch(e){console.error("Failed to load vendor tools:",e)}this.init(),this.handleInitialTool()}handleInitialTool(){const e=new URLSearchParams(window.location.search).get("tool");if(e&&document.cookie.includes("portal_access_token=")){const t=this.TREASURY_TOOLS.find(t=>t.name.toLowerCase()===decodeURIComponent(e).toLowerCase());t&&setTimeout(()=>this.showToolModal(t),500)}}init(){this.assignTags(),this.setupInteractions(),this.setupSearch(),this.setupModals(),this.setupSideMenu(),this.setupShortlistMenu(),this.setupBottomNav(),this.updateCounts(),this.populateCategoryTags(),this.filterAndDisplayTools(),this.applyViewStyles(),this.handleResponsive(),window.addEventListener("resize",()=>this.handleResponsive()),setTimeout(()=>{const e=document.getElementById("loadingScreen");e&&(e.style.display="none")},800)}handleTouchStart(e,t){this.isMobile()&&(this.swipeStart={x:e.touches[0].clientX,y:e.touches[0].clientY,time:Date.now(),element:t})}handleTouchMove(e,t){if(!this.swipeStart||!this.isMobile())return;const o=Math.abs(e.touches[0].clientX-this.swipeStart.x);o>Math.abs(e.touches[0].clientY-this.swipeStart.y)&&o>10&&e.preventDefault()}handleTouchEnd(e,t,o){if(!this.swipeStart||!this.isMobile())return;const n=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY,a=n-this.swipeStart.x,i=s-this.swipeStart.y,r=Date.now()-this.swipeStart.time,l=Math.abs(a),c=Math.abs(i);if(Math.max(l,c)/r>this.swipeVelocityThreshold&&r<1e3){let e=!1;("sideMenu"===t&&a<-this.swipeThreshold||"shortlistMenu"===t&&a>this.swipeThreshold||("toolModal"===t||"categoryModal"===t)&&i>this.swipeThreshold)&&(e=!0),e&&o&&o()}this.swipeStart=null}setupSwipeToClose(e,t,o){const n=document.getElementById(e);if(!n)return;const s=e=>this.handleTouchStart(e,t),a=e=>this.handleTouchMove(e,t),i=e=>this.handleTouchEnd(e,t,o);n.addEventListener("touchstart",s,{passive:!1}),n.addEventListener("touchmove",a,{passive:!1}),n.addEventListener("touchend",i,{passive:!1}),n._swipeHandlers={touchstart:s,touchmove:a,touchend:i}}assignTags(){this.TREASURY_TOOLS.forEach(e=>{const t=this.CATEGORY_TAGS[e.category]||[];e.tags=[...t].sort((e,t)=>e.localeCompare(t))})}setupInteractions(){document.querySelectorAll(".filter-tab").forEach(e=>{e.addEventListener("click",e=>{document.querySelector(".filter-tab.active")?.classList.remove("active"),e.target.classList.add("active"),this.currentFilter=e.target.dataset.category,this.filterAndDisplayTools()})}),document.querySelectorAll(".category-header").forEach(e=>{e.addEventListener("click",t=>{if(t.target.closest(".show-more-category-tags-btn")||t.target.closest(".show-less-category-tags-btn"))return;const o=e.dataset.category;o&&this.CATEGORY_INFO[o]&&this.showCategoryModal(this.CATEGORY_INFO[o],o)})}),document.getElementById("mainContent").addEventListener("click",e=>{if(e.target.classList.contains("show-more-tags-btn")){e.stopPropagation();const t=e.target.dataset.toolName,o=this.TREASURY_TOOLS.find(e=>e.name===t);if(o){const t=e.target.parentElement,n=[...o.tags].sort((e,t)=>e.localeCompare(t));t.innerHTML=n.map(e=>`<span class="tool-tag">${e}</span>`).join(""),t.innerHTML+=`<button class="show-less-tags-btn" data-tool-name="${o.name}">Show less</button>`}}else if(e.target.classList.contains("show-less-tags-btn")){e.stopPropagation();const t=e.target.dataset.toolName,o=this.TREASURY_TOOLS.find(e=>e.name===t);if(o){const t=e.target.parentElement,n=[...o.tags].sort((e,t)=>e.localeCompare(t)),s=n.slice(0,3),a=n.length>3;t.innerHTML=s.map(e=>`<span class="tool-tag">${e}</span>`).join(""),a&&(t.innerHTML+=`<button class="show-more-tags-btn" data-tool-name="${o.name}">... more</button>`)}}else if(e.target.classList.contains("show-more-category-tags-btn")){e.stopPropagation();const t=e.target.dataset.category,o=e.target.parentElement,n=[...this.CATEGORY_TAGS[t]||[]].sort((e,t)=>e.localeCompare(t));o.innerHTML=n.map(e=>`<span class="category-tag">${e}</span>`).join(""),o.innerHTML+=`<button class="show-less-category-tags-btn" data-category="${t}">Show less</button>`}else if(e.target.classList.contains("show-less-category-tags-btn")){e.stopPropagation();const t=e.target.dataset.category,o=e.target.parentElement,n=[...this.CATEGORY_TAGS[t]||[]].sort((e,t)=>e.localeCompare(t)),s=n.slice(0,3),a=n.length>3;o.innerHTML=s.map(e=>`<span class="category-tag">${e}</span>`).join(""),a&&(o.innerHTML+=`<button class="show-more-category-tags-btn" data-category="${t}">... more</button>`)}})}setupSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("searchClear");e&&(e.addEventListener("input",e=>{this.searchTerm=e.target.value.toLowerCase(),t&&(t.style.display=this.searchTerm?"block":"none"),this.filterAndDisplayTools()}),e.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),this.closeSideMenu())})),t&&t.addEventListener("click",()=>{e&&(e.value="",e.focus()),this.searchTerm="",t.style.display="none",this.filterAndDisplayTools()})}setupTagSearch(){const e=document.getElementById("tagSearchInput"),t=document.getElementById("tagSearchClear");e&&e.addEventListener("input",()=>{const o=e.value.toLowerCase();t&&(t.style.display=o?"block":"none"),this.filterTagCheckboxes(o)}),t&&t.addEventListener("click",()=>{e&&(e.value="",e.focus()),t.style.display="none",this.filterTagCheckboxes("")})}filterTagCheckboxes(e){const t=document.getElementById("tagFilters");if(!t)return;t.querySelectorAll(".checkbox-item").forEach(t=>{const o=t.textContent.toLowerCase();t.style.display=o.includes(e)?"flex":"none"});const o=document.getElementById("showMoreTagFilters"),n=document.getElementById("showLessTagFilters"),s=document.getElementById("extraTagFilters");o&&n&&s&&(e?(s.style.display="block",o.style.display="none",n.style.display="none"):(s.style.display="none",n.style.display="none",o.style.display="inline-block"))}setupModals(){const e=document.getElementById("toolModal"),t=document.getElementById("modalClose");t&&t.addEventListener("click",()=>this.closeModal("toolModal")),e&&e.addEventListener("click",e=>{null===e.target.closest(".ttp-modal-content")&&this.closeModal("toolModal")});const o=document.getElementById("categoryModal"),n=document.getElementById("categoryModalClose");n&&n.addEventListener("click",()=>this.closeModal("categoryModal")),o&&o.addEventListener("click",e=>{null===e.target.closest(".ttp-modal-content")&&this.closeModal("categoryModal")});const s=document.querySelector(".treasury-portal"),a=s?.querySelector(".intro-video-target")||s,i=a?.getAttribute("data-video-src")||"",r=a?.getAttribute("data-poster")||"",l=(e,t)=>{const o=document.createElement("div");o.className="video-wrapper";const n=document.createElement("video");n.src=e,n.autoplay=!1,n.muted=!1,n.playsInline=!0,n.preload="metadata",n.setAttribute("playsinline",""),t&&(n.poster=t);const s=document.createElement("button");s.className="video-play-button",s.setAttribute("aria-label","Play video"),s.innerHTML="‚ñ∂";const a=()=>{n.paused?n.play():n.pause()};return n.addEventListener("click",a),s.addEventListener("click",e=>{e.stopPropagation(),a()}),n.addEventListener("play",()=>o.classList.add("playing")),n.addEventListener("pause",()=>o.classList.remove("playing")),n.addEventListener("ended",()=>o.classList.remove("playing")),o.appendChild(n),o.appendChild(s),o},c=()=>{a.innerHTML='<div class="intro-video-fallback">Intro video unavailable</div>'};if(i){const e=l(i,r);e.querySelector("video").onerror=c,a.innerHTML="",a.appendChild(e)}else c();document.querySelectorAll(".category-video-target").forEach(e=>{const t=e.getAttribute("data-video-src"),o=e.getAttribute("data-poster");if(t){const n=l(t,o);e.innerHTML="",e.appendChild(n)}}),this.setupSwipeToClose("toolModal","toolModal",()=>this.closeModal("toolModal")),this.setupSwipeToClose("categoryModal","categoryModal",()=>this.closeModal("categoryModal")),document.addEventListener("keydown",e=>{"Escape"===e.key&&(this.closeModal("toolModal"),this.closeModal("categoryModal"))})}openModal(e){if(e){this.previousFocusedElement=document.activeElement,e.classList.add("show"),portalRoot.classList.add("modal-open");const t=e.querySelector('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');if(t)t.focus();else{const t=e.querySelector(".ttp-modal-content");t&&t.focus()}}}showToolModal(e){const t=document.getElementById("toolModal"),o=document.getElementById("modalTitle"),n=document.getElementById("modalDescription"),s=document.getElementById("modalWebsiteLink"),a=t?.querySelector(".modal-body"),i=document.getElementById("modalToolLogo"),r=document.getElementById("modalTags");if(!t||!a)return;if(this.spaceHandler&&(this.spaceHandler.el.removeEventListener("keydown",this.spaceHandler.fn),this.spaceHandler=null),this.currentToolId=e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-"),o&&(o.textContent=e.name),n&&(n.textContent=e.desc),s&&(e.websiteUrl?(s.href=e.websiteUrl,s.style.display="inline-flex"):s.style.display="none"),i&&(e.logoUrl?e.websiteUrl?i.outerHTML=`<a href="${e.websiteUrl}" target="_blank" rel="noopener noreferrer" class="modal-logo-link">\n                                <img id="modalToolLogo" class="modal-tool-logo" src="${e.logoUrl}" alt="${e.name} logo">\n                            </a>`:(i.src=e.logoUrl,i.alt=`${e.name} logo`,i.style.display="block",i.parentElement.classList.contains("modal-logo-link")&&i.parentElement.replaceWith(i)):i.style.display="none",e.websiteUrl&&e.logoUrl&&setTimeout(()=>{const e=document.querySelector(".modal-logo-link");e&&e.addEventListener("click",e=>{e.stopPropagation()})},0)),r){const t=[...e.tags||[]].sort((e,t)=>e.localeCompare(t)),o=t.slice(0,5),n=t.length>5;r.innerHTML=o.map(e=>`<span class="tool-tag">${e}</span>`).join(""),n&&(r.innerHTML+=`<button class="show-more-modal-tags-btn" data-tool-name="${e.name}">... more (${t.length-5})</button>`),r.addEventListener("click",e=>{if(e.target.classList.contains("show-more-modal-tags-btn")){e.stopPropagation();const t=e.target.dataset.toolName,o=this.TREASURY_TOOLS.find(e=>e.name===t);if(o){const e=[...o.tags||[]].sort((e,t)=>e.localeCompare(t));r.innerHTML=e.map(e=>`<span class="tool-tag">${e}</span>`).join(""),r.innerHTML+=`<button class="show-less-modal-tags-btn" data-tool-name="${t}">Show less</button>`}}else if(e.target.classList.contains("show-less-modal-tags-btn")){e.stopPropagation();const t=e.target.dataset.toolName,o=this.TREASURY_TOOLS.find(e=>e.name===t);if(o){const e=[...o.tags||[]].sort((e,t)=>e.localeCompare(t)),n=e.slice(0,5),s=e.length>5;r.innerHTML=n.map(e=>`<span class="tool-tag">${e}</span>`).join(""),s&&(r.innerHTML+=`<button class="show-more-modal-tags-btn" data-tool-name="${t}">... more (${e.length-5})</button>`)}}})}const l=a.querySelector(".video-demo-section");if(l&&l.remove(),e.videoUrl){const t=document.createElement("div");t.className="feature-section video-demo-section";const o=this.videoTimes[this.currentToolId]||0;if(e.videoUrl.includes("youtu.be/")||e.videoUrl.includes("youtube.com/watch")){let n=e.videoUrl;if(e.videoUrl.includes("youtu.be/")){n=`https://www.youtube.com/embed/${e.videoUrl.split("youtu.be/")[1].split("?")[0]}`}else{n=`https://www.youtube.com/embed/${new URL(e.videoUrl).searchParams.get("v")}`}n+=(n.includes("?")?"&":"?")+"enablejsapi=1&playsinline=1",o&&(n+=`&start=${Math.floor(o)}&autoplay=1`),t.innerHTML=`\n                            <h4>üé• Product Differentiator</h4>\n                            <div class="video-container">\n                                <iframe id="yt-${this.currentToolId}" src="${n}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" playsinline></iframe>\n                            </div>\n                        `}else t.innerHTML=`\n                            <h4>üé• Product Differentiator</h4>\n                            <div class="video-container">\n                                <video src="${e.videoUrl}" controls playsinline></video>\n                            </div>\n                        `,o&&(t.querySelector("video").currentTime=o);const n=r?.closest(".feature-section");n?a.insertBefore(t,n):a.appendChild(t)}this.openModal(t);const c=t.querySelector(".modal-content, .ttp-modal-content");if(c){const e=e=>{if("Space"===e.code||" "===e.key){const o=t.querySelector("video"),n=t.querySelector("iframe");o?(e.preventDefault(),o.paused?o.play():o.pause()):n&&n.contentWindow&&(e.preventDefault(),n.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}',"https://www.youtube.com"))}};c.addEventListener("keydown",e),this.spaceHandler={el:c,fn:e}}}showCategoryModal(e,t){const o=document.getElementById("categoryModal"),n=document.getElementById("categoryModalTitle"),s=document.getElementById("categoryModalDescription"),a=document.getElementById("categoryModalFeatures"),i=o?.querySelector(".modal-body");n&&(n.textContent=e.name),s&&(s.textContent=e.description),a&&(a.innerHTML="",e.features.forEach(e=>{const t=document.createElement("li");t.textContent=e,a.appendChild(t)}));const r=i?.querySelector(".video-demo-section");if(r&&r.remove(),e.videoUrl&&i){const t=document.createElement("div");t.className="feature-section video-demo-section";let o="";if(e.videoUrl.includes("youtu.be/")||e.videoUrl.includes("youtube.com/watch")){let t=e.videoUrl;if(e.videoUrl.includes("youtu.be/")){t=`https://www.youtube.com/embed/${e.videoUrl.split("youtu.be/")[1].split("?")[0]}`}else if(e.videoUrl.includes("youtube.com/watch")){t=`https://www.youtube.com/embed/${new URL(e.videoUrl).searchParams.get("v")}`}t+=(t.includes("?")?"&":"?")+"enablejsapi=1&playsinline=1",o=`<iframe src="${t}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" playsinline></iframe>`}else{o=`<video controls preload="metadata"${e.videoPoster?` poster="${e.videoPoster}"`:""} playsinline>\n                                        <source src="${e.videoUrl}" type="video/mp4">\n                                        Your browser does not support the video tag.\n                                      </video>`}t.innerHTML=`\n                        <h4>üé• Category Overview Video</h4>\n                        <div class="video-container">\n                             ${o}\n                        </div>\n                    `,i.insertBefore(t,i.firstChild)}this.openModal(o)}closeModal(e){const t=document.getElementById(e);if(t&&t.classList.contains("show")){if(t.classList.remove("show"),portalRoot.classList.remove("modal-open"),"toolModal"===e&&this.currentToolId){const e=this.currentToolId;t.querySelectorAll("iframe").forEach(t=>{t.src.includes("youtube.com")&&t.contentWindow&&(t.contentWindow.postMessage(JSON.stringify({event:"command",func:"getCurrentTime",id:`yt-${e}`}),"https://www.youtube.com"),t.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"https://www.youtube.com"))}),t.querySelectorAll("video").forEach(t=>{this.videoTimes[e]=t.currentTime,t.pause()}),this.spaceHandler&&(this.spaceHandler.el.removeEventListener("keydown",this.spaceHandler.fn),this.spaceHandler=null)}this.previousFocusedElement&&(this.previousFocusedElement.focus(),this.previousFocusedElement=null)}}filterAndDisplayTools(){let e;if(this.searchTerm){const t=this.searchTerm.toLowerCase();e=this.TREASURY_TOOLS.filter(e=>[e.name,e.desc,e.target,...e.tags||[],...e.features||[]].join(" ").toLowerCase().includes(t))}else e="ALL"===this.currentFilter?this.TREASURY_TOOLS:this.TREASURY_TOOLS.filter(e=>e.category===this.currentFilter);this.advancedFilters.features.length&&(e=e.filter(e=>this.advancedFilters.features.every(t=>(e.tags||[]).includes(t)))),this.advancedFilters.hasVideo&&(e=e.filter(e=>e.videoUrl)),"name"===this.currentSort?e=e.sort((e,t)=>e.name.localeCompare(t.name)):"category"===this.currentSort&&(e=e.sort((e,t)=>e.category.localeCompare(t.category))),this.filteredTools=e,this.displayFilteredTools(),this.updateVisibleCounts()}displayFilteredTools(){const e=["CASH","LITE","TRMS"],t=this.filteredTools.length>0,o=document.getElementById("noResults");o&&(o.style.display=t?"none":"block");const n=document.getElementById("listViewContainer");if(!this.groupByCategory||this.searchTerm||this.advancedFilters.features.length||this.advancedFilters.hasVideo)return e.forEach(e=>{const t=document.querySelector(`.category-section[data-category="${e}"]`);t&&(t.style.display="none")}),void(n&&(n.innerHTML="",this.filteredTools.sort((e,t)=>e.name.localeCompare(t.name)).forEach(e=>{const t=this.createToolCard(e,e.category);n.appendChild(t)}),n.style.display=t?"grid":"none"));n&&(n.style.display="none"),e.forEach(e=>{const t=document.querySelector(`.category-section[data-category="${e}"]`),o=document.getElementById(`tools-${e}`),n=this.filteredTools.filter(t=>t.category===e).sort((e,t)=>e.name.localeCompare(t.name));o&&(o.innerHTML="");let s=!1;s=(this.searchTerm||"ALL"===this.currentFilter||this.currentFilter===e)&&n.length>0,t&&(t.style.display=s?"block":"none"),s&&o&&n.forEach(t=>{const n=this.createToolCard(t,e);o.appendChild(n)})})}createToolCard(e,t){const o=document.createElement("div");o.className=`tool-card tool-${t.toLowerCase()}`,o.draggable=!this.isMobile(),o.dataset.name=e.name;const n=[...e.tags||this.CATEGORY_TAGS[e.category]||[]].sort((e,t)=>e.localeCompare(t)),s=n.slice(0,3),a=n.length>3;if(o.innerHTML=`\n                    <div class="tool-card-content">\n                        <div class="tool-header">\n                            <div class="tool-info">\n                                <div class="tool-name">\n                                    <div class="tool-name-group">\n                                        <span class="tool-name-title">${e.name}</span>\n                                    </div>\n                                    ${e.logoUrl?`<a href="${e.websiteUrl||"#"}" target="_blank" rel="noopener noreferrer" class="tool-logo-link" ${e.websiteUrl?"":'style="pointer-events: none; cursor: default;"'}><img class="tool-logo-inline" src="${e.logoUrl}" alt="${e.name} logo"></a>`:""}\n                                    <div class="tool-actions">\n                                        <div class="tool-icon">${{TRMS:"üè¢",CASH:"üí∞",LITE:"‚ö°"}[e.category]}</div>\n                                    </div>\n                                </div>\n                                ${e.videoUrl?'<button type="button" class="video-indicator">‚ñ∂ Demo</button>':""}\n                                <div class="tool-type">${"CASH"===e.category?"Cash Tools":"LITE"===e.category?"TMS-Lite":e.category}</div>\n                            </div>\n                        </div>\n                        <div class="tool-description">${e.desc}</div>\n                    </div>\n                    <div class="tool-card-actions">\n                        <div class="tool-tags">\n                            ${s.map(e=>`<span class="tool-tag">${e}</span>`).join("")}\n                            ${a?`<button class="show-more-tags-btn" data-tool-name="${e.name}">... more</button>`:""}\n                        </div>\n                    </div>\n                `,o.addEventListener("click",t=>{t.target.closest(".show-more-tags-btn")||t.target.closest(".show-less-tags-btn")||this.showToolModal(e)}),this.isMobile()||(o.addEventListener("dragstart",t=>{t.dataTransfer.setData("text/plain",e.name),this.openShortlistMenu("dragstart")}),o.addEventListener("touchstart",()=>{this.touchDragTool=e,this.openShortlistMenu()}),o.addEventListener("touchmove",e=>{const t=document.getElementById("shortlistContainer");if(!t)return;const o=e.touches[0],n=document.elementFromPoint(o.clientX,o.clientY);n&&t.contains(n)?t.classList.add("drag-over"):t.classList.remove("drag-over"),e.preventDefault()},{passive:!1}),o.addEventListener("touchend",e=>{const t=document.getElementById("shortlistContainer");if(t&&t.classList.remove("drag-over"),this.touchDragTool&&t){const o=e.changedTouches[0],n=document.elementFromPoint(o.clientX,o.clientY);n&&t.contains(n)&&!this.shortlist.some(e=>e.tool.name===this.touchDragTool.name)&&(this.shortlist.push({tool:this.touchDragTool,notes:""}),this.renderShortlist())}this.touchDragTool=null})),e.websiteUrl){const e=o.querySelector(".tool-logo-link");e&&e.addEventListener("click",e=>{e.stopPropagation()})}return o}populateCategoryTags(){["CASH","LITE","TRMS"].forEach(e=>{const t=document.getElementById(`category-tags-${e}`);if(t){const o=[...this.CATEGORY_TAGS[e]||[]].sort((e,t)=>e.localeCompare(t)),n=o.slice(0,3),s=o.length>3;t.innerHTML=n.map(e=>`<span class="category-tag">${e}</span>`).join(""),s&&(t.innerHTML+=`<button class="show-more-category-tags-btn" data-category="${e}">... more</button>`)}})}populateTagFilters(){const e=document.getElementById("tagFilters");if(!e)return;const t=[...new Set(Object.values(this.CATEGORY_TAGS).flat())].sort((e,t)=>e.localeCompare(t));this.allTags=t;const o=t.slice(0,4),n=t.slice(4),s=e=>{const t=`tag-${e.replace(/[^a-z0-9]+/gi,"-").toLowerCase()}`;return`<div class="checkbox-item"><input type="checkbox" id="${t}" value="${e}"><label for="${t}">${e}</label></div>`};e.innerHTML=o.map(s).join(""),n.length&&(e.innerHTML+=`<div id="extraTagFilters" style="display:none;">${n.map(s).join("")}</div>`,e.innerHTML+='<button class="show-more-filter-tags-btn" id="showMoreTagFilters">Show more</button>',e.innerHTML+='<button class="show-less-filter-tags-btn" id="showLessTagFilters" style="display:none;">Show less</button>')}updateVisibleCounts(){let e=0;["CASH","LITE","TRMS"].forEach(t=>{const o=this.filteredTools.filter(e=>e.category===t).length,n=document.getElementById(`count-${t}`);n&&(n.textContent=o),e+=o});const t=document.getElementById("totalTools");t&&(t.textContent=this.searchTerm?e:this.TREASURY_TOOLS.length)}updateCounts(){["CASH","LITE","TRMS"].forEach(e=>{const t=this.TREASURY_TOOLS.filter(t=>t.category===e).length,o=document.getElementById(`count-${e}`);o&&(o.textContent=t)});const e=document.getElementById("totalTools");e&&(e.textContent=this.TREASURY_TOOLS.length)}setupSideMenu(){const e=document.getElementById("sideMenuToggle"),t=document.getElementById("externalMenuToggle"),o=document.getElementById("sideMenu"),n=document.getElementById("sideMenuOverlay");e&&e.addEventListener("click",()=>this.toggleSideMenu()),t&&t.addEventListener("click",()=>this.toggleSideMenu()),n&&n.addEventListener("click",()=>this.closeSideMenu()),o&&o.addEventListener("click",e=>{this.isMobile()||this.sideMenuOpen||e.target!==o||(e.stopPropagation(),this.openSideMenu())}),this.setupSwipeToClose("sideMenu","sideMenu",()=>this.closeSideMenu()),this.setupAdvancedFilters(),this.setupViewOptions(),this.setupQuickActions(),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.sideMenuOpen&&this.closeSideMenu()})}setupAdvancedFilters(){this.populateTagFilters(),this.setupTagSearch();const e=document.getElementById("showMoreTagFilters"),t=document.getElementById("showLessTagFilters"),o=document.getElementById("extraTagFilters");e&&t&&o&&(e.addEventListener("click",()=>{o.style.display="block",e.style.display="none",t.style.display="inline-block"}),t.addEventListener("click",()=>{o.style.display="none",t.style.display="none",e.style.display="inline-block"}));document.querySelectorAll('#tagFilters input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>{this.updateFeatureFilters(),this.filterAndDisplayTools(),this.updateFilterCount()})});const n=document.getElementById("hasVideoFilter");n&&n.addEventListener("change",e=>{this.advancedFilters.hasVideo=e.target.checked,this.filterAndDisplayTools(),this.updateFilterCount()});const s=document.getElementById("sortFilter");s&&s.addEventListener("change",e=>{this.currentSort=e.target.value,this.filterAndDisplayTools()})}setupViewOptions(){const e=document.querySelectorAll(".view-option");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active"),this.currentView=t.dataset.view,this.applyViewStyles()})});const t=document.getElementById("groupByFilter");t&&t.addEventListener("change",e=>{this.groupByCategory="category"===e.target.value,this.filterAndDisplayTools()})}setupQuickActions(){const e=document.getElementById("clearAllFilters");e&&e.addEventListener("click",()=>this.clearAllFilters());const t=document.getElementById("resetToDefaults");t&&t.addEventListener("click",()=>this.resetToDefaults());const o=document.getElementById("applyFilters");o&&o.addEventListener("click",()=>{this.filterAndDisplayTools(),this.closeSideMenu()})}toggleSideMenu(){this.sideMenuOpen?this.closeSideMenu():this.openSideMenu()}openSideMenu(){this.closeShortlistMenu();const e=document.getElementById("sideMenu"),t=document.getElementById("sideMenuOverlay"),o=document.getElementById("sideMenuToggle"),n=document.getElementById("externalMenuToggle");e?.classList.add("open"),portalRoot.classList.add("side-menu-open"),t?.classList.add("show"),o?.classList.add("active"),n&&(n.classList.add("active"),n.style.display="none"),this.isMobile()?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):portalRoot.style.overflow="hidden",document.addEventListener("click",this.handleOutsideSideMenuClick,!0),this.sideMenuOpen=!0}closeSideMenu(){const e=document.getElementById("sideMenu"),t=document.getElementById("sideMenuOverlay"),o=document.getElementById("sideMenuToggle"),n=document.getElementById("externalMenuToggle");e?.classList.remove("open"),t?.classList.remove("show"),o?.classList.remove("active"),n&&(n.classList.remove("active"),n.style.display=this.isMobile()?"none":"flex"),portalRoot.classList.remove("side-menu-open"),this.isMobile()?(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""):portalRoot.style.overflow="",document.removeEventListener("click",this.handleOutsideSideMenuClick,!0),this.sideMenuOpen=!1}setupShortlistMenu(){const e=document.getElementById("shortlistMenuToggle"),t=document.getElementById("shortlistMenuOverlay"),o=document.getElementById("externalShortlistToggle"),n=document.getElementById("shortlistContainer"),s=document.getElementById("clearShortlist"),a=document.getElementById("exportShortlistBtn");e&&e.addEventListener("click",()=>this.toggleShortlistMenu()),o&&o.addEventListener("click",()=>this.toggleShortlistMenu()),t&&(t.addEventListener("dragover",e=>e.preventDefault()),t.addEventListener("drop",e=>e.preventDefault())),this.setupSwipeToClose("shortlistMenu","shortlistMenu",()=>this.closeShortlistMenu());const i=document.getElementById("shortlistMenu");if(i&&i.addEventListener("click",e=>{this.isMobile()||this.shortlistMenuOpen||e.target!==i||(e.stopPropagation(),this.openShortlistMenu())}),s&&s.addEventListener("click",()=>this.clearShortlist()),a&&a.addEventListener("click",()=>this.exportShortlist()),n){let e=null,t=null,o=null,s=null;const a=()=>n.classList.add("drag-over"),i=()=>n.classList.remove("drag-over");n.addEventListener("dragstart",t=>{t.target.classList.contains("shortlist-card")?(e=t.target,t.dataTransfer.setData("text/plain",t.target.dataset.name),t.dataTransfer.effectAllowed="move",t.dataTransfer.setDragImage(new Image,0,0),o=t.target.cloneNode(!0),o.classList.add("drag-preview"),o.style.width=`${t.target.offsetWidth}px`,o.style.height=`${t.target.offsetHeight}px`,portalRoot.appendChild(o),s=e=>{o.style.left=`${e.clientX}px`,o.style.top=`${e.clientY}px`},window.addEventListener("pointermove",s),s(t)):e=null}),n.addEventListener("dragenter",a),n.addEventListener("dragleave",e=>{e.target===n&&i()}),n.addEventListener("dragover",t=>{if(t.preventDefault(),e){const o=t.target.closest(".shortlist-card");if(o&&o!==e){const s=o.getBoundingClientRect(),a=t.clientY-s.top>s.height/2;n.insertBefore(e,a?o.nextSibling:o)}}}),n.addEventListener("drop",t=>{if(t.preventDefault(),i(),e)this.shortlist=Array.from(n.querySelectorAll(".shortlist-card")).map(e=>{const t=e.dataset.name;return this.shortlist.find(e=>e.tool.name===t)}),e=null,this.renderShortlist();else{const e=t.dataTransfer.getData("text/plain"),o=this.TREASURY_TOOLS.find(t=>t.name===e);o&&!this.shortlist.some(t=>t.tool.name===e)&&(this.shortlist.push({tool:o,notes:""}),this.renderShortlist())}}),n.addEventListener("dragend",()=>{window.removeEventListener("pointermove",s),o&&(o.remove(),o=null)}),n.addEventListener("touchstart",e=>{const n=e.target.closest(".shortlist-card");if(n){t=n,a(),o=n.cloneNode(!0),o.classList.add("drag-preview"),o.style.width=`${n.offsetWidth}px`,o.style.height=`${n.offsetHeight}px`,portalRoot.appendChild(o);const s=e.touches[0];o.style.left=`${s.clientX}px`,o.style.top=`${s.clientY}px`}}),n.addEventListener("touchmove",e=>{if(!t)return;const s=e.touches[0];o&&(o.style.left=`${s.clientX}px`,o.style.top=`${s.clientY}px`);const a=document.elementFromPoint(s.clientX,s.clientY)?.closest(".shortlist-card");if(a&&a!==t){const e=a.getBoundingClientRect(),o=s.clientY-e.top>e.height/2;n.insertBefore(t,o?a.nextSibling:a)}e.preventDefault()},{passive:!1}),n.addEventListener("touchend",()=>{t&&(i(),this.shortlist=Array.from(n.querySelectorAll(".shortlist-card")).map(e=>{const t=e.dataset.name;return this.shortlist.find(e=>e.tool.name===t)}),t=null,o&&(o.remove(),o=null),this.renderShortlist())})}document.addEventListener("keydown",e=>{"Escape"===e.key&&this.shortlistMenuOpen&&this.closeShortlistMenu()}),this.renderShortlist(),this.setupPermanentToolPicker()}toggleShortlistMenu(){this.shortlistMenuOpen?this.closeShortlistMenu():this.openShortlistMenu()}openShortlistMenu(e){this.closeSideMenu();const t=document.getElementById("shortlistMenu"),o=document.getElementById("shortlistMenuOverlay"),n=document.getElementById("shortlistMenuToggle"),s=document.getElementById("externalShortlistToggle");t?.classList.add("open"),portalRoot.classList.add("shortlist-menu-open"),o?.classList.add("show"),document.addEventListener("click",this.handleOutsideShortlistMenuClick),n?.classList.add("active"),s?.classList.add("active"),this.isMobile()?(document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.width="100%"):portalRoot.style.overflow="hidden",this.shortlistMenuOpen=!0,this.permanentToolPickerInitialized&&this.updatePermanentToolPicker()}closeShortlistMenu(){const e=document.getElementById("shortlistMenu"),t=document.getElementById("shortlistMenuOverlay"),o=document.getElementById("shortlistMenuToggle"),n=document.getElementById("externalShortlistToggle");e?.classList.remove("open"),portalRoot.classList.remove("shortlist-menu-open"),t?.classList.remove("show"),document.removeEventListener("click",this.handleOutsideShortlistMenuClick),o?.classList.remove("active"),n?.classList.remove("active"),this.isMobile()?(document.body.style.overflow="",document.body.style.position="",document.body.style.width=""):portalRoot.style.overflow="",this.shortlistMenuOpen=!1}renderShortlist(){const e=document.getElementById("shortlistContainer"),t=document.getElementById("shortlistEmptyMessage");if(!e)return;e.innerHTML="",t&&e.appendChild(t),0===this.shortlist.length?(e.classList.add("empty"),t&&t.classList.remove("visually-hidden")):(e.classList.remove("empty"),t&&t.classList.add("visually-hidden"),this.shortlist.forEach(t=>{const o=document.createElement("div");o.className="shortlist-card",o.draggable=!0,o.dataset.name=t.tool.name,o.innerHTML=`\n                            <div class="shortlist-card-header">\n                                <div class="shortlist-card-title-wrapper">\n                                    ${t.tool.logoUrl?`<img class="shortlist-logo" src="${t.tool.logoUrl}" alt="${t.tool.name} logo">`:""}\n                                    <span class="shortlist-card-title">${t.tool.name}</span>\n                                    ${t.tool.websiteUrl?`<a class="shortlist-card-link" href="${t.tool.websiteUrl}" target="_blank" rel="noopener noreferrer" aria-label="Visit website">Visit Website</a>`:""}\n                                </div>\n                                <div class="shortlist-card-buttons">\n                                    <button class="move-up" data-name="${t.tool.name}" aria-label="Move up">‚ñ≤</button>\n                                    <button class="move-down" data-name="${t.tool.name}" aria-label="Move down">‚ñº</button>\n                                    <button class="remove-shortlist" data-name="${t.tool.name}" aria-label="Remove">√ó</button>\n                                </div>\n                            </div>\n                            <textarea class="shortlist-note" data-name="${t.tool.name}" placeholder="Notes...">${t.notes||""}</textarea>`,e.appendChild(o)})),e.querySelectorAll(".remove-shortlist").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.name;this.shortlist=this.shortlist.filter(e=>e.tool.name!==t),this.renderShortlist()})}),e.querySelectorAll(".move-up").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.name,o=this.shortlist.findIndex(e=>e.tool.name===t);if(o>0){const[e]=this.shortlist.splice(o,1);this.shortlist.splice(o-1,0,e),this.renderShortlist()}})}),e.querySelectorAll(".move-down").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.name,o=this.shortlist.findIndex(e=>e.tool.name===t);if(o<this.shortlist.length-1&&-1!==o){const[e]=this.shortlist.splice(o,1);this.shortlist.splice(o+1,0,e),this.renderShortlist()}})}),e.querySelectorAll(".shortlist-note").forEach(e=>{e.addEventListener("input",e=>{const t=e.target.dataset.name,o=this.shortlist.find(e=>e.tool.name===t);o&&(o.notes=e.target.value)})});const o=document.getElementById("exportShortlistBtn");o&&(o.disabled=0===this.shortlist.length),this.updatePermanentToolPicker()}updatePermanentToolPicker(){const e=document.getElementById("permanentToolPicker")?.querySelector(".tool-picker-button"),t=document.getElementById("permanentDropdown"),o=document.getElementById("permanentSearch"),n=document.getElementById("permanentList");if(!(e&&t&&o&&n))return;const s=this.TREASURY_TOOLS.filter(e=>!this.shortlist.some(t=>t.tool.name===e.name));n.innerHTML=s.map(e=>`<li data-name="${e.name}">${e.name}</li>`).join(""),e.textContent=s.length>0?`Add a Tool (${s.length} available)`:"All tools added",e.disabled=0===s.length,o.value="",t.style.display="none"}setupPermanentToolPicker(){const e=document.getElementById("permanentToolPicker")?.querySelector(".tool-picker-button"),t=document.getElementById("permanentDropdown"),o=document.getElementById("permanentSearch"),n=document.getElementById("permanentList");e&&t&&o&&n&&(e.addEventListener("click",e=>{e.stopPropagation();const n="block"===t.style.display;t.style.display=n?"none":"block",n||o.focus()}),o.addEventListener("input",()=>{const e=o.value.toLowerCase();n.querySelectorAll("li").forEach(t=>{const o=t.textContent.toLowerCase().includes(e);t.style.display=o?"block":"none"})}),n.addEventListener("click",e=>{if("LI"===e.target.tagName){const o=e.target.dataset.name,n=this.TREASURY_TOOLS.find(e=>e.name===o);n&&!this.shortlist.some(e=>e.tool.name===o)&&(this.shortlist.push({tool:n,notes:""}),this.renderShortlist()),t.style.display="none"}}),document.addEventListener("click",e=>{const o=document.getElementById("permanentToolPicker");o&&!o.contains(e.target)&&(t.style.display="none")}),this.updatePermanentToolPicker(),this.permanentToolPickerInitialized=!0)}clearShortlist(){this.shortlist=[],this.renderShortlist()}setupBottomNav(){const e=document.getElementById("bottomSearch"),t=document.getElementById("bottomShortlist");if(e){const t=e=>{e.preventDefault(),e.stopPropagation(),this.shortlistMenuOpen&&this.closeShortlistMenu(),this.sideMenuOpen?this.closeSideMenu():(this.openSideMenu(),setTimeout(()=>{const e=document.getElementById("searchInput");e&&(e.focus(),/iPad|iPhone|iPod/.test(navigator.userAgent)&&e.click())},350))};e.addEventListener("touchstart",e=>e.preventDefault()),e.addEventListener("click",t),e.addEventListener("touchend",e=>{e.preventDefault(),t(e)})}if(t){const e=e=>{e.preventDefault(),e.stopPropagation(),this.sideMenuOpen&&this.closeSideMenu(),this.toggleShortlistMenu()};t.addEventListener("touchstart",e=>e.preventDefault()),t.addEventListener("click",e),t.addEventListener("touchend",t=>{t.preventDefault(),e(t)})}}updateFeatureFilters(){const e=document.querySelectorAll('#tagFilters input[type="checkbox"]');this.advancedFilters.features=Array.from(e).filter(e=>e.checked).map(e=>e.value)}applyViewStyles(){document.querySelectorAll(".tools-grid").forEach(e=>{e.classList.remove("list-view"),"list"===this.currentView?(e.classList.add("list-view"),e.style.gridTemplateColumns="1fr"):this.isMobile()?e.style.gridTemplateColumns="1fr":e.style.gridTemplateColumns="repeat(auto-fill, minmax(320px, 1fr))"})}exportShortlist(){const e=this.shortlist.map(e=>({name:e.tool.name,category:e.tool.category,website:e.tool.websiteUrl?e.tool.websiteUrl.split("?")[0]:"",notes:e.notes||""})),t=this.convertToCSV(e);this.downloadCSV(t,"shortlist.csv")}convertToCSV(e){if(!e.length)return"";const t=Object.keys(e[0]);return[t.join(","),...e.map(e=>t.map(t=>`"${String(e[t]).replace(/"/g,'""')}"`).join(","))].join("\n")}downloadCSV(e,t){const o=new Blob([e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");if(void 0!==n.download){const e=URL.createObjectURL(o);n.setAttribute("href",e),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),URL.revokeObjectURL(e),document.body.removeChild(n)}}clearAllFilters(){const e=document.getElementById("searchInput");e&&(e.value="",this.searchTerm="");const t=document.getElementById("tagSearchInput");t&&(t.value="");const o=document.getElementById("tagSearchClear");o&&(o.style.display="none"),this.filterTagCheckboxes(""),document.querySelector(".filter-tab.active")?.classList.remove("active"),document.querySelector('.filter-tab[data-category="ALL"]')?.classList.add("active"),this.currentFilter="ALL",this.advancedFilters={features:[],hasVideo:!1};document.querySelectorAll('#tagFilters input[type="checkbox"],#hasVideoFilter').forEach(e=>e.checked=!1),this.filterAndDisplayTools(),this.updateFilterCount()}resetToDefaults(){this.clearAllFilters();const e=document.getElementById("sortFilter");e&&(e.value="name"),this.currentSort="name",document.querySelectorAll(".view-option").forEach(e=>e.classList.remove("active")),document.querySelector('.view-option[data-view="grid"]')?.classList.add("active"),this.currentView="grid";const t=document.getElementById("groupByFilter");t&&(t.value="category"),this.groupByCategory=!0,this.applyViewStyles(),this.filterAndDisplayTools()}updateFilterCount(){const{features:e,hasVideo:t}=this.advancedFilters;let o=0;o+=e.length,t&&o++;const n=document.getElementById("filterCount");n&&(n.textContent=o>0?`(${o})`:"")}}let lastTouchEnd=0;document.addEventListener("touchend",function(e){const t=Date.now();t-lastTouchEnd<=300&&e.preventDefault(),lastTouchEnd=t},{passive:!1});