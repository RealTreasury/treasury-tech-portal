<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treasury Tech Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Allow vertical scrolling inside the iframe */
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: #f8f9fa;
            color: #281345;
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }

        html {
            overflow-x: hidden;
            overflow-y: auto;
            height: 100%;
            min-height: 100%;
        }

        html, body {
            scroll-behavior: smooth;
        }

        body.side-menu-open,
        body.shortlist-menu-open {
            overflow: hidden;
        }
        
        body.modal-open {
            overflow: hidden;
        }

        .container {
            position: relative;
            margin-left: 60px;
            margin-right: 60px;
            transition:
                margin-left 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                margin-right 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            height: auto;
        }

        /* Search Box */
        .search-container {
            position: relative;
            max-width: 400px;
            width: 100%;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }

        /* Compact search variant used for tag search */
        .search-container.tag-search {
            max-width: 100%;
            box-shadow: none;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: none;
            border-radius: 12px;
            font-size: 0.9rem;
            background: white;
            transition: all 0.3s ease;
            outline: none;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .search-container.tag-search .search-input {
            padding: 8px 12px;
            padding-left: 12px;
            border-radius: 8px;
        }
        .search-input::placeholder {
            color: #9ca3af;
        }

        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(114, 22, 244, 0.15);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7e7e7e;
            font-size: 16px;
        }

        .search-clear {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #7e7e7e;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: none;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .search-clear:hover {
            background: #f3f4f6;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #7216f4 0%, #8f47f6 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .title-section h1 {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #7216f4 0%, #8f47f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #7e7e7e;
            font-weight: 400;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        /* Header Middle Section */
        .header-middle {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
            justify-content: center;
        }

        /* Stats Cards */
        .stats-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px 16px;
            text-align: center;
            min-width: 100px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 1.4rem;
            font-weight: 700;
            color: #7216f4;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #7e7e7e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        /* Filter Tabs */
        .filter-tabs {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 4px;
            display: flex;
            gap: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .filter-tab {
            background: transparent;
            border: none;
            color: #7e7e7e;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .filter-tab:hover {
            color: #281345;
            background: #f3f4f6;
        }

        .filter-tab.active {
            background: linear-gradient(135deg, #7216f4 0%, #8f47f6 100%);
            color: #fff;
            box-shadow: 0 2px 10px rgba(114, 22, 244, 0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px 60px 20px;
        }

        /* No Results Message */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #7e7e7e;
            display: none;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #281345;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-weight: 700;
            line-height: 1.2;
        }

        .no-results p {
            font-size: 1rem;
            color: #7e7e7e;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        /* Category Section */
        .category-section {
            margin-bottom: 60px;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-header:hover {
            background: rgba(99, 102, 241, 0.02);
            margin: -15px -15px 25px -15px;
            padding: 15px 15px 15px 15px;
            border-radius: 12px;
        }

        .category-info {
            flex: 1;
        }

        .category-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #281345;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            line-height: 1.4; /* Prevent emoji icons from being cut off */
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
        }

        .category-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-enterprise .category-badge {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .category-cash .category-badge {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .category-lite .category-badge {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .category-description {
            color: #7e7e7e;
            font-size: 0.95rem;
            max-width: 800px;
            line-height: 1.5;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .category-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }

        .category-tag {
            background: #f3f4f6;
            color: #6b7280;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 500;
            border: 1px solid #e5e7eb;
        }

        .show-more-category-tags-btn,
        .show-less-category-tags-btn {
            background: none;
            border: none;
            color: #6366f1;
            cursor: pointer;
            font-size: 0.65rem;
            font-weight: 500;
            padding: 2px 4px;
            border-radius: 4px;
            margin-left: 4px;
        }

        .show-more-category-tags-btn:hover,
        .show-less-category-tags-btn:hover {
            background: #f3f4f6;
        }

        .show-more-filter-tags-btn,
        .show-less-filter-tags-btn {
            background: none;
            border: none;
            color: #6366f1;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 8px;
        }

        .show-more-filter-tags-btn:hover,
        .show-less-filter-tags-btn:hover {
            background: #f3f4f6;
        }

        .category-count {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            min-width: 100px;
        }

        .count-number {
            font-size: 2rem;
            font-weight: 700;
            color: #7216f4;
            display: block;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .count-label {
            font-size: 0.8rem;
            color: #7e7e7e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 12px;
        }

        /* Tool Card */
        .tool-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #7216f4, transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tool-card:hover {
            background: white;
            border-color: #7216f4;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .tool-card:hover::before {
            opacity: 1;
        }

        .tool-card-content {
            flex-grow: 1;
        }

        .tool-card-actions {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }

        .tool-header {
            display: flex;
            align-items: flex-start; /* align icon with title */
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 6px;
        }

        .tool-meta {
            display: flex;
            align-items: flex-start; /* align with vendor name */
            flex-wrap: nowrap;
            gap: 12px;
        }

        .tool-info {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            gap: 2px; /* tighter vertical spacing */
        }

        .tool-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #281345;
            margin-bottom: 0;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            line-height: 1.2;
            display: flex;
            align-items: center;
            gap: 8px; /* small space between elements */
            position: relative;
            z-index: 1;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.5px;
        }

        .tool-name-title {
            margin-right: 0; /* keep video icon flush to name */
        }

        .tool-logo {
            width: 100px;
            height: 100px;
            object-fit: contain;
            background-color: transparent;
            flex-shrink: 0;
        }

        .tool-logo-inline {
            width: 90px; /* keep full size on desktop */
            height: 90px;
            object-fit: contain;
            margin-top: -4px; /* lift logo to line up with title */
        }

        @media (max-width: 768px) {
            .tool-logo-inline {
                width: 60px; /* slightly smaller on mobile */
                height: 60px;
            }
        }

        .modal-tool-logo {
            width: 100px; /* smaller logo in popup */
            height: 100px;
            object-fit: contain;
            display: block;
            margin: 0;
        }

        .video-indicator {
            font-size: 0.8rem;
            opacity: 0.7;
            background: rgba(99, 102, 241, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
            margin-right: 16px; /* space before logo */
        }

        .tool-card:hover .video-indicator {
            opacity: 1;
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.4);
        }

        .tool-type {
            font-size: 0.8rem;
            color: #7e7e7e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .tool-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            color: white;
        }

        .tool-trms .tool-icon {
            background: linear-gradient(135deg, rgba(114, 22, 244, 0.8), rgba(143, 71, 246, 0.8));
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .tool-cash .tool-icon {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.8), rgba(5, 150, 105, 0.8));
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .tool-lite .tool-icon {
            background: linear-gradient(135deg, rgba(59,130,246,0.8), rgba(29,78,216,0.8));
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .tool-description {
            color: #7e7e7e;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 0;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .tool-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .tool-tag {
            background: #f3f4f6;
            color: #6b7280;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 500;
            border: 1px solid #e5e7eb;
        }

        .show-more-tags-btn,
        .show-less-tags-btn {
            background: none;
            border: none;
            color: #6366f1;
            cursor: pointer;
            font-size: 0.65rem;
            font-weight: 500;
            padding: 2px 4px;
            border-radius: 4px;
            margin-left: 4px;
        }

        .show-more-tags-btn:hover,
        .show-less-tags-btn:hover {
            background: #f3f4f6;
        }

        /* Modal uses position: fixed to always be in the viewport */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            background: rgba(40, 19, 69, 0.25);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s linear;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }

        /* Modal Content Box */
        .modal-content {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 550px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.95) translateY(10px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        /* Modal Header */
        .modal-header {
            padding: 16px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #281345;
            flex-grow: 1;
            margin: 0;
            line-height: 1.4;
        }
        
        .modal-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }

        .modal-header-actions .modal-close {
            margin-left: 0;
        }
        
        /* Modal Body: Scrollable */
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex-grow: 1;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal-body::-webkit-scrollbar { width: 6px; }
        .modal-body::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        .modal-body::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .modal-body::-webkit-scrollbar-thumb:hover { background: #aab5c6; }

        /* Modal Close Button */
        .modal-close {
            background: #f3f4f6;
            border: none;
            color: #6b7280;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-weight: 400;
            line-height: 1;
        }

        .modal-close:hover {
            background: #e5e7eb;
            color: #281345;
            transform: rotate(90deg) scale(1.1);
        }
        
        .video-container {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
            margin-bottom: 20px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .feature-section {
            margin-bottom: 24px;
        }
        
        /* Added class specifically for dynamically added video sections */
        .video-demo-section {
            /* This class is just a marker for JS */
        }

        .feature-section h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #281345;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-list {
            list-style: none;
            display: grid;
            gap: 10px;
        }

        .feature-list li {
            color: #4b5563;
            font-size: 0.9rem;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }

        .feature-list li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: #6366f1;
            font-weight: bold;
        }

        .website-link--modal {
            background: linear-gradient(135deg, #7216f4, #8f47f6);
            color: #ffffff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            padding: 6px 12px;
            font-size: 0.8rem;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
            box-shadow: 0 4px 15px -5px rgba(114, 22, 244, 0.5);
            border: none;
        }

        .website-link--modal:hover {
            background: linear-gradient(135deg, #8f47f6, #7216f4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(114, 22, 244, 0.6);
            color: #ffffff;
        }

        .tool-website-link {
            display: inline-block;
            text-align: center;
            background: linear-gradient(135deg, #7216f4, #8f47f6);
            color: #ffffff;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.75rem;
            padding: 4px 8px;
            line-height: 1.1;
            margin-right: 8px;
        }

        .tool-website-link:hover {
            background: linear-gradient(135deg, #8f47f6, #7216f4);
            text-decoration: none;
        }

        /* Mobile adjustments */
        /* Hide external toggles across common mobile widths */
        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .header-middle {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-middle .search-container {
                width: 100%;
            }

            .stats-bar {
                justify-content: space-around;
                width: 100%;
            }

            .filter-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .stat-card {
                flex: 1;
                min-width: 0;
            }

            .filter-tabs {
                justify-content: center;
            }

            .main-content {
                padding: 20px 15px;
            }

            .category-section {
                padding: 20px;
            }

            .category-header {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .category-count {
                align-self: center;
            }

            .tools-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .tool-card {
                padding: 14px;
            }

            .modal-content {
                max-height: calc(100vh - 40px);
                max-width: 95vw;
            }

            .modal-header,
            .modal-body {
                padding: 16px;
            }
            .title-section h1 {
                font-size: 1.5rem;
            }

            .filter-tab {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .category-title {
                font-size: 1.3rem;
                line-height: 1.4;
            }

            .tool-name {
                font-size: 1.1rem;
                letter-spacing: 0.5px;
            }

            .search-container {
                max-width: 100%;
            }
            .side-menu {
                width: 85%;
                transform: translateX(-100%);
            }
            .shortlist-menu {
                width: 85%;
                transform: translateX(100%);
            }
            body.side-menu-pinned .container {
                margin-left: 0;
            }
            .side-menu-pin,
            .shortlist-menu-pin {
                display: none;
            }

            .external-menu-toggle,
            .external-shortlist-toggle {
                display: none !important;
            }

            .container {
                margin-left: 0;
                margin-right: 0;
            }

        }

        /* Side Menu Toggle Button */
        .menu-toggle {
            background: rgba(255,255,255,0.25);
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7216f4;
            transition: background 0.3s ease;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .menu-toggle:hover {
            background: rgba(255,255,255,0.4);
        }

        .icon {
            display:flex;
            align-items:center;
            justify-content:center;
            width:100%;
            height:100%;
            font-size:16px;
        }

        .menu-toggle .icon::before {
            content: '\2630';
        }

        .menu-toggle.active .icon::before {
            content: '\2715';
        }

        /* Side Menu */
        .side-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border-right: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 0 20px 20px 0;
            z-index: 1001;
            transform: translateX(-240px);
            opacity: 1;
            pointer-events: auto;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                        opacity 0.3s ease;
            overflow-y: auto;
        }

        .side-menu.open {
            transform: translateX(0);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
            opacity: 1;
            pointer-events: auto;
        }

        body.side-menu-open #sideMenuToggle {
            display: flex;
        }

        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(40, 19, 69, 0.1);
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .side-menu-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: none;
        }

        .side-menu-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #f6f7fb 0%, #e8ecfc 100%);
            color: #281345;
        }

        .side-menu-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0;
        }

        .side-menu:not(.open) .side-menu-title,
        .side-menu:not(.open) .menu-section {
            display: none;
        }


        .side-menu:not(.open) {
            overflow: visible;
        }

        /* Hide internal toggle when the menu is closed to avoid overlap */
        .side-menu:not(.open) .menu-toggle {
            display: none;
        }


        .side-menu-content {
            padding: 0;
        }

        .menu-section {
            border-bottom: 1px solid #f3f4f6;
        }

        .menu-section-header {
            padding: 6px 12px;
            background: rgba(249, 250, 251, 0.8);
            font-weight: 600;
            color: #281345;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #e5e7eb;
        }

        .menu-section-content {
            padding: 6px 12px;
        }

        .filter-group {
            margin-bottom: 6px;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .filter-select,
        .filter-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.85rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: #7216f4;
            box-shadow: 0 0 0 3px rgba(114, 22, 244, 0.1);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 4px 0;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #7216f4;
        }

        .checkbox-item label {
            font-size: 0.85rem;
            color: #4b5563;
            cursor: pointer;
            line-height: 1.2;
        }

        .view-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .view-option {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.75rem;
        }

        .view-option.active {
            background: linear-gradient(135deg, #7216f4, #8f47f6);
            color: white;
            border-color: #7216f4;
        }

        .view-option:hover:not(.active) {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .action-btn {
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #7216f4, #8f47f6);
            color: white;
            border: none;
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, #8f47f6, #7216f4);
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: white;
            color: #7216f4;
            border: 1px solid #7216f4;
        }

        .action-btn.secondary:hover {
            background: #f8f9ff;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .external-menu-toggle {
            position: fixed;
            top: 10px;
            left: 5px;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7216f4;
            transition: background 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 1002;
        }
        @media (max-width: 768px) {
            .external-menu-toggle {
                top: 50%;
                left: 0;
                transform: translateY(-50%);
                width: 40px;
                height: 90px;
                border-radius: 0 8px 8px 0;
            }
        }


        .external-menu-toggle:hover {
            background: rgba(255,255,255,0.25);
        }

        .external-menu-toggle .icon {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255,255,255,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .external-menu-toggle .icon::before {
            content: '\2630';
        }

        .external-menu-toggle.active .icon {
            background: rgba(114,22,244,0.9);
            color: #fff;
        }

        .external-menu-toggle.active .icon::before {
            content: '\2715';
        }

        body.side-menu-open .external-menu-toggle {
            display: none;
        }

        .external-shortlist-toggle {
            position: fixed;
            top: 10px;
            right: 5px;
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #7216f4;
            transition: background 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            z-index: 1002;
        }

        .external-shortlist-toggle:hover {
            background: rgba(255,255,255,0.25);
        }

        .external-shortlist-toggle .icon {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255,255,255,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .external-shortlist-toggle .icon::before {
            content: '\2630';
        }

        .external-shortlist-toggle.active .icon {
            background: rgba(114,22,244,0.9);
            color: #fff;
        }

        .external-shortlist-toggle.active .icon::before {
            content: '\2715';
        }

        body.shortlist-menu-open .external-shortlist-toggle {
            display: none;
        }

        /* Shortlist Menu */
        .shortlist-menu {
            position: fixed;
            top: 0;
            right: 0;
            width: 340px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31,38,135,0.37);
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px 0 0 20px;
            z-index: 1001;
            transform: translateX(280px);
            opacity: 1;
            pointer-events: auto;
            transition: transform 0.3s cubic-bezier(0.4,0,0.2,1), box-shadow 0.3s cubic-bezier(0.4,0,0.2,1), opacity 0.3s ease;
            overflow-y: auto;
        }

        .shortlist-menu.open {
            transform: translateX(0);
            box-shadow: 0 12px 48px rgba(0,0,0,0.2);
            opacity: 1;
            pointer-events: auto;
        }


        .shortlist-menu-overlay {
            position: fixed;
            top:0;
            right:0;
            width:100%;
            height:100%;
            background: rgba(40,19,69,0.1);
            z-index:1000;
            opacity:0;
            visibility:hidden;
            pointer-events:none;
            transition: opacity 0.3s ease;
        }

        .shortlist-menu-overlay.show {
            opacity:1;
            visibility:visible;
            pointer-events:none;
        }

        .shortlist-menu-header {
            position: sticky;
            top: 0;
            z-index: 1;
            padding:20px;
            border-bottom:1px solid #e5e7eb;
            display:flex;
            align-items:center;
            justify-content:space-between;
            background: linear-gradient(135deg, #f6f7fb 0%, #e8ecfc 100%);
            color:#281345;
        }


        .shortlist-menu-title {
            font-size:1.2rem;
            font-weight:700;
            margin:0;
        }

        .shortlist-menu:not(.open) .shortlist-menu-title,
        .shortlist-menu:not(.open) .shortlist-section { display:none; }

        .shortlist-menu:not(.open) { overflow:visible; }

        /* Ensure toggle remains clickable when shortlist menu is closed */
        .shortlist-menu:not(.open) .menu-toggle {
            pointer-events: auto;
        }


        .shortlist-menu-content { padding:0; }
        .shortlist-section { border-bottom:1px solid #f3f4f6; }

        .shortlist-container {
            display:flex;
            flex-direction:column;
            gap:8px;
            margin-top:12px;
            min-height:250px;
            border:1px dashed #e5e7eb;
            padding:8px;
        }

        .shortlist-container.drag-over {
            background:#eceffd;
            border-color:#7216f4;
        }

        .shortlist-container.empty {
            justify-content:center;
            align-items:center;
        }

        #toolPicker {
            padding:8px 12px;
            margin-top:8px;
            width:100%;
            border-radius:8px;
            background:rgba(255,255,255,0.25);
            border:1px solid rgba(255,255,255,0.3);
            backdrop-filter:blur(8px);
            -webkit-backdrop-filter:blur(8px);
            box-shadow:0 4px 8px rgba(0,0,0,0.05);
            color:#281345;
            font-size:0.9rem;
        }
        #toolPicker:focus {
            outline:none;
            border-color:#7216f4;
            box-shadow:0 0 0 3px rgba(114,22,244,0.1);
        }

        .shortlist-empty-message {
            color: #4b5563;
            font-size: 1rem;
            text-align: center;
        }

        .visually-hidden {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0 0 0 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        .shortlist-card {
            background:#f9fafb;
            border:1px solid #e5e7eb;
            border-radius:8px;
            padding:8px 12px;
            display:flex;
            flex-direction:column;
            gap:4px;
            cursor:move;
        }

        .shortlist-card-header {
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .shortlist-note {
            width:100%;
            font-size:0.8rem;
            padding:4px;
            border:1px solid #e5e7eb;
            border-radius:4px;
            resize:vertical;
        }

        .shortlist-card-title-wrapper { display:flex; align-items:center; gap:4px; }
        .shortlist-card-title { font-size:0.9rem; font-weight:600; color:#281345; }
        .shortlist-card-link {
            display:inline-block;
            text-align:center;
            background: linear-gradient(135deg, #7216f4, #8f47f6);
            color:#ffffff;
            text-decoration:none;
            margin-left:4px;
            border-radius:6px;
            font-weight:600;
            font-size:0.75rem;
            padding: 4px 8px;
            line-height:1.1;
        }
        .shortlist-card-link:hover {
            background: linear-gradient(135deg, #8f47f6, #7216f4);
            text-decoration:none;
        }

        .shortlist-logo {
            width: 36px;
            height: 36px;
            object-fit: contain;
        }

        .remove-shortlist {
            background:none;
            border:none;
            color:#7216f4;
            cursor:pointer;
            font-size:1rem;
        }

        .move-up, .move-down {
            background:none;
            border:none;
            color:#7216f4;
            cursor:pointer;
            font-size:1rem;
        }

        .shortlist-card-buttons {
            display:flex;
            gap:4px;
            align-items:center;
        }

        .tips-section {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 20px;
            margin: 40px auto;
            max-width: 800px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        .tips-section h3 {
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            color: #281345;
            text-align: center;
        }

        .tips-section ul {
            padding-left: 20px;
            list-style: disc;
        }

        .tips-section li {
            margin-bottom: 8px;
            color: #7e7e7e;
            font-size: 0.95rem;
        }

        /* Bottom navigation for mobile */
        .bottom-nav {
            display: none;
        }
        @media (max-width: 768px) {
            .bottom-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                display: flex !important;
                justify-content: space-around;
                background: rgba(255,255,255,0.7);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-top: 1px solid rgba(255,255,255,0.3);
                box-shadow: 0 -4px 8px rgba(0,0,0,0.1);
                z-index: 1002;
            }

            /* Fully hide sidebars until opened */
            .side-menu,
            .shortlist-menu {
                width: 85%;
            }

            .side-menu {
                transform: translateX(-100%);
            }

            .shortlist-menu {
                transform: translateX(100%);
            }

            .bottom-nav button {
                flex: 1;
                padding: 16px 0; /* Increase height for easier tapping */
                background: none;
                border: none;
                font-size: 0.9rem;
                color: #281345;
            }

            .bottom-nav button .icon {
                display: inline-block;
                margin-right: 4px;
                vertical-align: middle;
                width: auto;
                height: auto;
                font-size: 1.2rem;
            }

            .bottom-nav button.active {
                background: linear-gradient(135deg, #7216f4 0%, #8f47f6 100%);
                color: #fff;
                box-shadow: 0 2px 10px rgba(114, 22, 244, 0.3);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <button class="external-menu-toggle" id="externalMenuToggle">
            <span class="icon"></span>
        </button>
        <button class="external-shortlist-toggle" id="externalShortlistToggle" aria-label="Open shortlist menu" title="Shortlist">
            <span class="icon"></span>
        </button>
        <!-- Loading Screen -->
        <div class="loading" id="loadingScreen" style="display: none; text-align: center; padding: 40px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">
            <div class="loading-logo" style="font-size: 3rem; margin-bottom: 1rem;">ðŸ’¼</div>
            <h1 style="color: #281345; font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Treasury Portal</h1>
            <p style="color: #7e7e7e; font-size: 1rem;">Loading financial tools ecosystem...</p>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="title-section">
                        <h1>Treasury Tech Portal</h1>
                        <p class="subtitle">Discover the complete treasury tech landscape</p>
                    </div>
                </div>

                <div class="header-middle">

                    <div class="stats-bar">
                        <div class="stat-card">
                            <div class="stat-number" id="totalTools">27</div>
                            <div class="stat-label">Tools</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Categories</div>
                        </div>
                    </div>
                </div>

                <div class="filter-tabs">
                    <button class="filter-tab active" data-category="ALL">All</button>
                    <button class="filter-tab" data-category="CASH">Cash Tools</button>
                    <button class="filter-tab" data-category="LITE">TMS-Lite</button>
                    <button class="filter-tab" data-category="TRMS">TRMS</button>
                </div>
        </div>
    </div>
    <div class="side-menu-overlay" id="sideMenuOverlay"></div>
    <div class="side-menu" id="sideMenu">
            <div class="side-menu-header">
                <div></div>
                <h3 class="side-menu-title">Menu</h3>
                <button class="menu-toggle" id="sideMenuToggle">
                    <span class="icon"></span>
                </button>
            </div>
            <div class="side-menu-content">
                <div class="menu-section">
                    <div class="menu-section-header">Search</div>
                    <div class="menu-section-content">
                        <div class="search-container">
                            <span class="search-icon">ðŸ”</span>
                            <input type="text" id="searchInput" class="search-input" placeholder="Search vendors, features, or tags...">
                            <button class="search-clear" id="searchClear" style="display: none;">Ã—</button>
                        </div>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-section-header">Filters</div>
                    <div class="menu-section-content">
                        <div class="filter-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="hasVideoFilter">
                                <label for="hasVideoFilter">Has Video</label>
                            </div>
                        </div>
                        <div class="filter-group">
                            <span class="filter-label">Tags</span>
                            <div class="search-container tag-search">
                                <input type="text" id="tagSearchInput" class="search-input" placeholder="Search tags...">
                                <button class="search-clear" id="tagSearchClear" style="display: none;">Ã—</button>
                            </div>
                            <div class="checkbox-group" id="tagFilters"></div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label" for="sortFilter">Sort By</label>
                            <select id="sortFilter" class="filter-select">
                                <option value="name">Name</option>
                                <option value="category">Category</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-section-header">View Options</div>
                    <div class="menu-section-content">
                        <div class="view-options">
                            <div class="view-option active" data-view="grid">Grid</div>
                            <div class="view-option" data-view="list">List</div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label" for="groupByFilter">Group Vendors</label>
                            <select id="groupByFilter" class="filter-select">
                                <option value="category" selected>By Category</option>
                                <option value="none">No Grouping</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="menu-section">
                    <div class="menu-section-header">Quick Actions</div>
                    <div class="menu-section-content">
                        <div class="action-buttons">
                            <button class="action-btn secondary" id="clearAllFilters">Clear Filters</button>
                            <button class="action-btn secondary" id="resetToDefaults">Reset Defaults</button>
                            <button class="action-btn primary" id="applyFilters">Apply &amp; Close</button>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <div class="shortlist-menu-overlay" id="shortlistMenuOverlay"></div>
    <div class="shortlist-menu" id="shortlistMenu">
        <div class="shortlist-menu-header">
            <div></div>
            <h3 class="shortlist-menu-title">Shortlist</h3>
            <button class="menu-toggle" id="shortlistMenuToggle" aria-label="Open shortlist menu" title="Shortlist">
                <span class="icon"></span>
            </button>
        </div>
        <div class="shortlist-menu-content">
            <div class="shortlist-section">
                <div class="menu-section-content">
                    <div id="shortlistContainer" class="shortlist-container empty">
                        <p id="shortlistEmptyMessage" class="shortlist-empty-message">Drag vendor cards here or click to add.</p>
                    </div>
                    <div class="tips-section">
                        <h3>Tips for Building a Tech Vendor Shortlist</h3>
                        <ul>
                            <li>Define must-have features and your budget early on.</li>
                            <li>Check how well each tool integrates with current systems.</li>
                            <li>Ask for references or case studies from similar companies.</li>
                            <li>Consider future scalability and support options.</li>
                        </ul>
                    </div>
                    <button class="action-btn secondary" id="clearShortlist" style="margin-top:12px;">Clear Shortlist</button>
                    <button class="action-btn primary" id="exportShortlistBtn" style="margin-top:12px;" disabled>Export Shortlist</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- No Results Message -->
            <div class="no-results" id="noResults" style="display: none;">
                <h3>No vendors found</h3>
                <p>Try adjusting your search terms or filters</p>
            </div>
            <div class="tools-grid" id="listViewContainer" style="display:none;"></div>

            <!-- Cash Tools Section -->
            <div class="category-section category-cash" data-category="CASH" style="display: block;">
                <div class="category-header" data-category="CASH">
                    <div class="category-info">
                        <h2 class="category-title">
                            ðŸ’° <span>Cash Tools</span>
                            <span class="category-badge">Essential</span>
                        </h2>
                        <p class="category-description">
                            Built in the cloud for modern finance, these cash visibility and forecasting platforms combine real-time connectivity, intelligent analytics, and automation to elevate liquidity and cash flow planning.
                        </p>
                        <div class="category-tags" id="category-tags-CASH"></div>
                    </div>
                    <div class="category-count">
                        <span class="count-number" id="count-CASH">10</span>
                        <span class="count-label">Solutions</span>
                    </div>
                </div>
                <div class="tools-grid" id="tools-CASH">
                    <!-- Tools will be populated by JavaScript -->
                </div>
            </div>

            <!-- TMS-Lite Section -->
            <div class="category-section category-lite" data-category="LITE" style="display: block;">
                <div class="category-header" data-category="LITE">
                    <div class="category-info">
                        <h2 class="category-title">
                            âš¡ <span>TMS-Lite</span>
                            <span class="category-badge">Scalable</span>
                        </h2>
                        <p class="category-description">
                            Built for more than visibility, these treasury platforms support treasury payments, detailed cash positioning, and growing complexityâ€”without jumping to a full enterprise solution.
                        </p>
                        <div class="category-tags" id="category-tags-LITE"></div>
                    </div>
                    <div class="category-count">
                        <span class="count-number" id="count-LITE">6</span>
                        <span class="count-label">Solutions</span>
                    </div>
                </div>
                <div class="tools-grid" id="tools-LITE">
                    <!-- Tools will be populated by JavaScript -->
                </div>
            </div>

            <!-- Enterprise Section -->
            <div class="category-section category-enterprise" data-category="TRMS" style="display: block;">
                <div class="category-header" data-category="TRMS">
                    <div class="category-info">
                        <h2 class="category-title">
                            ðŸ¢ <span>Treasury & Risk Management Systems (TRMS)</span>
                            <span class="category-badge">Advanced</span>
                        </h2>
                        <p class="category-description">
                            Full-scale treasury management platforms for complex treasury operations. These solutions handle complex derivatives, multi-entity consolidation, advanced risk analytics, and comprehensive regulatory compliance. Built for organizations managing billions in assets with sophisticated financial operations.
                        </p>
                        <div class="category-tags" id="category-tags-TRMS"></div>
                    </div>
                    <div class="category-count">
                        <span class="count-number" id="count-TRMS">11</span>
                        <span class="count-label">Solutions</span>
                    </div>
                </div>
                <div class="tools-grid" id="tools-TRMS">
                    <!-- Tools will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Tool Details Modal -->
        <div class="modal" id="toolModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
            <div class="modal-content" tabindex="-1">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle"></h3>
                    <div class="modal-header-actions">
                        <img id="modalToolLogo" class="modal-tool-logo" alt="">
                        <a id="modalWebsiteLink" href="#" target="_blank" rel="noopener noreferrer" class="website-link--modal" style="display: none;">Website</a>
                        <button class="modal-close" id="modalClose">Ã—</button>
                    </div>
                </div>
                <div class="modal-body">
                    <!-- The Overview is now static in the HTML structure -->
                    <div class="feature-section">
                        <h4>ðŸŽ¯ Overview</h4>
                        <p id="modalDescription"></p>
                    </div>
                    <div class="feature-section">
                        <h4>ðŸ·ï¸ Tags</h4>
                        <div id="modalTags" class="tool-tags"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Category Details Modal -->
        <div class="modal" id="categoryModal" role="dialog" aria-modal="true" aria-labelledby="categoryModalTitle">
            <div class="modal-content" tabindex="-1">
                <div class="modal-header">
                    <h3 class="modal-title" id="categoryModalTitle"></h3>
                     <div class="modal-header-actions">
                        <button class="modal-close" id="categoryModalClose">Ã—</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="feature-section">
                        <h4>ðŸ“‹ Description</h4>
                        <p id="categoryModalDescription"></p>
                    </div>
                    <div class="feature-section">
                        <h4>ðŸŽ¯ Key Characteristics</h4>
                        <ul class="feature-list" id="categoryModalFeatures">
                            <!-- Features will be populated by JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="bottom-nav" id="bottomNav">
        <button id="bottomSearch"><span class="icon">ðŸ”</span> Search</button>
        <button id="bottomShortlist"><span class="icon">ðŸ“</span> Shortlist</button>
    </div>

    <script>
        const EMBED_ORIGIN = 'https://realtreasury.com';
        let treasuryStack;

        function postHeight() {
            if (window.parent !== window) {
                const h = Math.max(
                    document.documentElement.scrollHeight,
                    document.documentElement.offsetHeight,
                    document.body.scrollHeight,
                    document.body.offsetHeight,
                    window.innerHeight
                );
                window.parent.postMessage({ 
                    type: "treasury-height",
                    height: h + 100
                }, "*");
                try {
                    window.parent.postMessage({ 
                        type: "treasury-height",
                        height: h + 100
                    }, EMBED_ORIGIN);
                } catch(e) {
                    /* Ignore if origin mismatch */
                }
            }
        }

function debounce(fn, delay) {
    let timer;
    return function() {
        clearTimeout(timer);
        timer = setTimeout(fn, delay);
    };
}

const debouncedPostHeight = debounce(postHeight, 100);

// Post height more frequently and reliably
window.addEventListener('load', () => {
    setTimeout(postHeight, 100);
    setTimeout(postHeight, 500);
    setTimeout(postHeight, 1000);
});
window.addEventListener('resize', debouncedPostHeight);

new ResizeObserver(() => {
    debouncedPostHeight();
}).observe(document.body);

new MutationObserver(() => {
    debouncedPostHeight();
}).observe(document.body, { 
    childList: true, 
    subtree: true, 
    attributes: true,
    attributeFilter: ['style', 'class']
});

document.addEventListener('DOMContentLoaded', () => {
    treasuryStack = new TreasuryStack();
    
    // Ensure iframe height is set after content loads
    setTimeout(() => {
        if (typeof postHeight === 'function') {
            postHeight();
        }
    }, 1500);
    
    // Handle window resize to properly enable/disable mobile features
    window.addEventListener('resize', () => {
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
            // Close any open menus on mobile
            if (treasuryStack.sideMenuOpen) treasuryStack.closeSideMenu();
            if (treasuryStack.shortlistMenuOpen) treasuryStack.closeShortlistMenu();
        } else {
            // Re-enable sidebar functionality on desktop
            treasuryStack.renderShortlist();
        }
        
        // Update height after resize
        setTimeout(() => {
            if (typeof postHeight === 'function') {
                postHeight();
            }
        }, 200);
    });
});
        class TreasuryStack {
            constructor() {
                this.TREASURY_TOOLS = [
                    // TRMS
                    {
                        "name": "Kyriba",
                        "category": "TRMS",
                        "desc": "Market-leading cloud treasury platform serving 3,000+ global clients with AI-powered cash forecasting, comprehensive risk management, and advanced derivatives trading capabilities.",
                        "features": ["AI-driven cash forecasting", "Real-time risk analytics", "Derivatives management", "Multi-bank connectivity", "Regulatory compliance", "Hedge accounting automation"],
                        "target": "Large enterprises and multinational corporations with complex treasury operations",
                        "videoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/kyriba-06-2025/",
                        "websiteUrl": "https://www.kyriba.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Kyriba.png"
                    }, {
                        "name": "GTreasury",
                        "category": "TRMS",
                        "desc": "Enterprise treasury platform known for deep ERP integration, advanced reporting, and sophisticated multi-entity consolidation for complex organizational structures.",
                        "features": ["Deep ERP integration", "Multi-entity consolidation", "Advanced analytics", "Customizable workflows", "Real-time reporting", "API connectivity"],
                        "target": "Fortune 500 companies requiring complex consolidation and reporting",
                        "videoUrl": "",
                        "websiteUrl": "https://gtreasury.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/GTreasury.png"
                    }, {
                        "name": "Reval",
                        "category": "TRMS",
                        "desc": "Comprehensive treasury and risk platform owned by ION Group, specializing in sophisticated derivatives valuation, hedge accounting, and regulatory reporting.",
                        "features": ["Derivatives valuation", "Hedge accounting", "Market data integration", "Risk analytics", "Regulatory reporting", "Trade capture"],
                        "target": "Financial institutions and corporations with complex derivative portfolios",
                        "videoUrl": "",
                        "websiteUrl": "https://iongroup.com/products/treasury/reval/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ION-Treasury.png"
                    }, {
                        "name": "Quantum",
                        "category": "TRMS",
                        "desc": "Advanced treasury management system with real-time risk analytics, portfolio optimization, and sophisticated hedging strategies for financial institutions.",
                        "features": ["Real-time risk monitoring", "Portfolio optimization", "Stress testing", "Automated hedging", "Compliance controls", "Advanced analytics"],
                        "target": "Investment banks and large financial institutions",
                        "videoUrl": "",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/FIS.png"
                    }, {
                        "name": "WallStreet Suite",
                        "category": "TRMS",
                        "desc": "Complete treasury and risk platform with multi-asset support, advanced analytics, and comprehensive regulatory reporting for complex financial operations.",
                        "features": ["Multi-asset support", "Advanced analytics", "Regulatory compliance", "Trade management", "Risk controls", "Market data feeds"],
                        "target": "Large banks and corporations requiring full-scale treasury operations",
                        "videoUrl": "",
                        "websiteUrl": "https://iongroup.com/products/treasury/wallstreet-suite/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ION-Treasury.png"
                    }, {
                        "name": "ATOM",
                        "category": "TRMS",
                        "desc": "Enterprise treasury platform focused on derivatives trading, risk management, and automated workflow processing for sophisticated financial operations.",
                        "features": ["Derivatives trading", "Automated workflows", "Risk management", "Trade processing", "Compliance monitoring", "Real-time analytics"],
                        "target": "Large corporations and financial institutions with active trading operations",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ATOM-TM.png"
                    }, {
                        "name": "Integrity",
                        "category": "TRMS",
                        "desc": "Enterprise treasury solution emphasizing governance, compliance, and audit trails for highly regulated financial environments and complex organizational structures.",
                        "features": ["Governance controls", "Audit trails", "Compliance management", "Policy enforcement", "Risk controls", "Workflow approval"],
                        "target": "Highly regulated industries requiring strict governance and compliance",
                        "videoUrl": "",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/FIS.png"
                    }, {
                        "name": "IT2",
                        "category": "TRMS",
                        "desc": "Integrated treasury technology platform combining cash management, risk analytics, and payment processing in a unified enterprise solution.",
                        "features": ["Integrated platform", "Cash management", "Risk analytics", "Payment processing", "Bank connectivity", "Unified reporting"],
                        "target": "Large enterprises seeking integrated treasury technology solutions",
                        "videoUrl": "",
                        "websiteUrl": "https://iongroup.com/products/treasury/it2/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ION-Treasury.png"
                    }, {
                        "name": "Datalog",
                        "category": "TRMS",
                        "desc": "Treasury management system with powerful analytics engine, multi-entity support, and comprehensive reporting capabilities for complex treasury operations.",
                        "features": ["Advanced analytics", "Multi-entity support", "Data visualization", "Custom reporting", "Cash positioning", "Risk monitoring"],
                        "target": "Large corporations requiring sophisticated analytics and reporting",
                        "videoUrl": "",
                        "websiteUrl": "https://www.datalog-finance.com/en/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Datalog-logo.png"
                    }, {
                        "name": "Coupa",
                        "category": "TRMS",
                        "desc": "Business spend management platform with integrated treasury operations, procurement workflows, and comprehensive spend analytics for enterprise organizations.",
                        "features": ["Spend management", "Treasury integration", "Procurement workflows", "Supplier management", "Analytics dashboard", "Automation tools"],
                        "target": "Large enterprises requiring integrated spend and treasury management",
                        "videoUrl": "",
                        "websiteUrl": "https://www.coupa.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Coupa.png"
                    }, {
                        "name": "Treasury Cube",
                        "category": "TRMS",
                        "desc": "Modular treasury platform with customizable features and scalable architecture that grows with your business needs and treasury complexity.",
                        "features": ["Modular design", "Customizable features", "Scalable architecture", "Growth-focused", "Flexible pricing", "Configurable workflows"],
                        "target": "Growing companies requiring scalable and customizable treasury solutions",
                        "websiteUrl": "https://treasurycube.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Treasury-Cube.png"
                    },

                    // CASH
                    {
                        "name": "Trovata",
                        "category": "CASH",
                        "desc": "AI-powered cash management platform providing real-time bank connectivity, predictive forecasting, and intelligent cash visibility for modern finance teams.",
                        "features": ["AI forecasting", "Real-time connectivity", "Predictive analytics", "Cash visibility", "Mobile access", "API integration"],
                        "target": "Mid to large companies seeking AI-driven cash management solutions",
                        "videoUrl": "",
                        "websiteUrl": "https://trovata.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Trovata.png"
                    }, {
                        "name": "Tesorio",
                        "category": "CASH",
                        "desc": "Machine learning-powered cash flow optimization platform that automates forecasting, scenario planning, and cash management workflows.",
                        "features": ["ML optimization", "Automated forecasting", "Scenario planning", "Workflow automation", "Integration tools", "Performance analytics"],
                        "target": "Growth companies and mid-market businesses optimizing cash flow",
                        "websiteUrl": "https://www.tesorio.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Tesorio.jpg"
                    }, {
                        "name": "Autocash",
                        "category": "CASH",
                        "desc": "AI-first cash management solution with predictive analytics, automated scenario modeling, and intelligent cash optimization recommendations.",
                        "features": ["AI predictions", "Automated scenarios", "Smart recommendations", "Risk assessment", "Cash optimization", "Intelligent alerts"],
                        "target": "Tech-forward companies embracing AI-driven financial operations",
                        "videoUrl": "",
                        "websiteUrl": "https://www.autocash.ai/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/AutoCash.png"
                    }, {
                        "name": "Balance",
                        "category": "CASH",
                        "desc": "Real-time cash visibility platform with automated bank reconciliation, multi-currency support, and streamlined cash positioning capabilities.",
                        "features": ["Real-time visibility", "Auto reconciliation", "Multi-currency", "Cash positioning", "Bank connectivity", "Streamlined UX"],
                        "target": "Companies needing real-time cash visibility and automated reconciliation",
                        "websiteUrl": "https://www.balancecash.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Balance-Cash.jpg"
                    }, {
                        "name": "Nilus",
                        "category": "CASH",
                        "desc": "Advanced cash forecasting platform with sophisticated scenario planning, variance analysis, and performance tracking for precise liquidity management.",
                        "features": ["Advanced forecasting", "Scenario planning", "Variance analysis", "Performance tracking", "Budget integration", "Precision modeling"],
                        "target": "Companies requiring sophisticated cash forecasting and scenario analysis",
                        "videoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/07/Nilus-06-2025.mp4",
                        "websiteUrl": "https://www.nilus.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Nilus.png"
                    }, {
                        "name": "Obol",
                        "category": "CASH",
                        "desc": "Digital treasury platform focused on liquidity optimization, real-time cash visibility, and modern workflow automation for finance teams.",
                        "features": ["Liquidity optimization", "Digital workflows", "Real-time data", "Modern interface", "Mobile platform", "Automated reporting"],
                        "target": "Modern finance teams seeking digital-first cash management solutions",
                        "videoUrl": "",
                        "websiteUrl": "https://www.obol.app/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Obol.png"
                    }, {
                        "name": "Panax",
                        "category": "CASH",
                        "desc": "Working capital optimization platform specializing in payment timing analytics, A/R and A/P integration, and cash flow enhancement strategies.",
                        "features": ["Working capital optimization", "Payment timing analytics", "A/R & A/P integration", "Cash flow enhancement", "Performance tracking", "Optimization tools"],
                        "target": "Companies focused on working capital optimization and payment timing",
                        "videoUrl": "",
                        "websiteUrl": "https://www.thepanax.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Panax.png"
                    }, {
                        "name": "Statement",
                        "category": "CASH",
                        "desc": "Automated bank statement processing platform with intelligent data extraction, reconciliation tools, and seamless integration capabilities.",
                        "features": ["Automated processing", "Data extraction", "Reconciliation tools", "Data validation", "Exception handling", "API integration"],
                        "target": "Companies seeking automated bank statement processing and data extraction",
                        "websiteUrl": "https://www.statement.io/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Statement.png"
                    }, {
                        "name": "Treasury Suite",
                        "category": "CASH",
                        "desc": "Comprehensive cash management suite combining forecasting, positioning, liquidity optimization, and workflow management in an integrated platform.",
                        "features": ["Comprehensive suite", "Cash forecasting", "Liquidity optimization", "Workflow management", "Bank connectivity", "Integrated platform"],
                        "target": "Companies requiring a complete cash management suite with integrated functionality",
                        "websiteUrl": "https://www.treasurysuite.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Treasury-Suite-Logo-PNG.png"
                    }, {
                        "name": "Vesto",
                        "category": "CASH",
                        "desc": "Cash positioning platform offering multibank cash flow monitoring and liquidity management capabilities.",
                        "features": ["Yield optimization", "Risk monitoring", "Investment tracking", "Liquidity management", "Performance analytics", "Compliance tools"],
                        "target": "Companies with significant cash positions seeking yield optimization",
                        "videoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Vesto-06-2025.mp4",
                        "websiteUrl": "https://www.vesto.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Vesto.png"
                    },

                    // LITE
                    {
                        "name": "Treasura",
                        "category": "LITE",
                        "desc": "User-friendly treasury management system offering essential cash and risk management features with simplified implementation and competitive pricing.",
                        "features": ["User-friendly", "Essential features", "Simplified setup", "Competitive pricing", "Basic reporting", "Standard integrations"],
                        "target": "Mid-market companies seeking accessible treasury management solutions",
                        "videoUrl": "",
                        "websiteUrl": "https://iongroup.com/products/treasury/treasura/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ION-Treasury.png"
                    }, {
                        "name": "Treasury Curve",
                        "category": "LITE",
                        "desc": "Simplified treasury management solution focusing on core functionality with intuitive interface and streamlined user experience.",
                        "features": ["Simplified interface", "Core functionality", "Easy setup", "Streamlined UX", "Basic reporting", "Cost-effective"],
                        "target": "Companies seeking simplified treasury management with core functionality",
                        "videoUrl": "",
                        "websiteUrl": "https://www.treasurycurve.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Treasury-Curve.png"
                    }, {
                        "name": "Bottomline",
                        "category": "LITE",
                        "desc": "Payment automation and cash management platform with strong banking integration, fraud protection, and multi-bank connectivity.",
                        "features": ["Payment automation", "Fraud protection", "Banking integration", "Multi-bank support", "Security controls", "Workflow tools"],
                        "target": "Companies prioritizing payment automation and banking integration",
                        "websiteUrl": "https://www.bottomline.com/us?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/bottomline-technologies-logo.png"
                    }, {
                        "name": "City Financials",
                        "category": "LITE",
                        "desc": "Treasury system specifically designed for mid-market companies with growth-oriented features, quick implementation, and scalable pricing.",
                        "features": ["Mid-market focus", "Growth-oriented", "Quick implementation", "Scalable pricing", "Support included", "Practical features"],
                        "target": "Mid-market companies seeking practical and growth-oriented solutions",
                        "videoUrl": "",
                        "websiteUrl": "https://iongroup.com/products/treasury/city-financials/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/ION-Treasury.png"
                    }, {
                        "name": "HighRadius",
                        "category": "LITE",
                        "desc": "Autonomous finance platform combining AI-powered accounts receivable optimization with treasury management for integrated financial operations.",
                        "features": ["AI automation", "A/R optimization", "Treasury integration", "Machine learning", "Process automation", "Autonomous finance"],
                        "target": "Companies seeking AI-powered automation for A/R and treasury operations",
                        "videoUrl": "",
                        "websiteUrl": "https://www.highradius.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/High-Radius.png"
                    }, {
                        "name": "Treasury4",
                        "category": "LITE",
                        "desc": "Next-generation treasury platform with modern UI/UX, cloud-native architecture, and intuitive workflows designed for the modern finance professional.",
                        "features": ["Modern UI/UX", "Cloud-native", "Intuitive workflows", "API-first design", "Mobile responsive", "Quick deployment"],
                        "target": "Modern finance teams seeking next-generation treasury technology",
                        "videoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/07/Treasury4-06-2025.mp4",
                        "websiteUrl": "https://www.treasury4.com/?utm_source=realtreasury&utm_medium=website&utm_campaign=vendor_referral",
                        "logoUrl": "https://aisbee08e5bdvaliantmaker.wpcomstaging.com/wp-content/uploads/2025/06/Treasury4Logo-GraphiteGreen.png"
                    }
                ];

                // Category information with videos
                this.CATEGORY_INFO = {
                    CASH: {
                        name: "Cash Tools",
                        badge: "Essential",
                        description: "Cash Tools are the essential first step for treasury teams moving away from manual spreadsheets. These platforms provide a single, unified view of bank balances and transactions through direct bank connections (via API or files). They excel at providing clear, real-time cash visibility and basic forecasting, allowing businesses to understand their current cash position and anticipate future needs without the complexity of a full TRMS.",
                        features: [
                            "Bank Connectivity (API, SFTP)",
                            "Basic Forecasting Tools",
                            "Cash Visibility",
                            "Transaction Search, Sort, Tag, Group"
                        ],
                        videoUrl: ""
                    },
                    LITE: {
                        name: "TMS-Lite",
                        badge: "Scalable",
                        description: "TMS-Lite solutions bridge the gap between basic Cash Tools and enterprise TRMS platforms. They build upon cash visibility by adding crucial treasury functions like multi-currency cash positioning, initiating treasury payments (wires, transfers), and managing basic financial instruments like foreign exchange contracts. These systems are ideal for growing companies whose needs have outpaced simple cash tools but do not yet require the full complexity of an enterprise system.",
                        features: [
                            "Bank Connectivity (API, SFTP)",
                            "Basic Forecasting Tools",
                            "Cash Visibility",
                            "Transaction Search, Sort, Tag, Group",
                            "Cash Positioning",
                            "Market Data",
                            "Treasury Payments (API, SFTP)"
                        ],
                        videoUrl: ""
                    },
                    TRMS: {
                        name: "Treasury & Risk Management Systems (TRMS)",
                        badge: "Advanced",
                        description: "Treasury & Risk Management Systems (TRMS) are comprehensive platforms for large, complex organizations. They offer a broad suite of tightly integrated modules far beyond cash visibility, covering debt and investment management, advanced financial risk analysis (FX, interest rates, commodities), hedge accounting, global payments, and in-house banking. These systems are designed to centralize and automate sophisticated treasury workflows.",
                        features: [
                            "Bank Connectivity (API, SFTP)",
                            "Basic Forecasting Tools",
                            "Cash Visibility",
                            "Transaction Search, Sort, Tag, Group",
                            "Cash Positioning",
                            "Market Data",
                            "Treasury Payments (API, SFTP)",
                            "Derivatives (Interest, FX)",
                            "Intercompany Loans",
                            "Instrument Valuations",
                            "AI Forecasting",
                            "AI Insights",
                            "AP Payments",
                            "Bank Account Management",
                            "Basic FX (Spots, FWD)",
                            "Cash Accounting",
                            "Debt Management",
                            "Deal Accounting",
                            "In-House Banking",
                            "Investments",
                            "SWIFT Connectivity"
                        ],
                        videoUrl: ""
                    }
                };

                const cashTags = ["Bank Connectivity", "Basic Forecasting Tools", "Cash Visibility", "Transaction Search, Sort, Tag, Group"];
                const liteTags = [...cashTags, "Cash Positioning", "Market Data", "Treasury Payments"];
                const trmsTags = [...liteTags, "AI Forecasting", "AI Insights", "AP Payments", "Bank Account Management", "Basic FX (Spots, FWD)", "Cash Accounting", "Debt Management", "Deal Accounting", "In-House Banking", "Investments", "SWIFT Connectivity", "Derivatives (Interest, FX)", "Intercompany Loans", "Instrument Valuations"];

                this.CATEGORY_TAGS = {
                    CASH: cashTags,
                    LITE: liteTags,
                    TRMS: trmsTags
                };

                this.currentFilter = 'ALL';
                this.searchTerm = '';
                this.filteredTools = [];
                this.allTags = [];
                this.advancedFilters = { features: [], hasVideo: false };
                this.currentSort = 'name';
                this.currentView = 'grid';
                this.groupByCategory = true;
                this.sideMenuOpen = false;
                this.shortlist = [];
                this.shortlistMenuOpen = false;
                this.touchDragTool = null;
                this.previousFocusedElement = null;
                this.videoTimes = {};
                this.currentToolId = null;
                this.spaceHandler = null;
                this.handleOutsideSideMenuClick = (e) => {
                    const sideMenu = document.getElementById('sideMenu');
                    const toggle = document.getElementById('sideMenuToggle');
                    const externalToggle = document.getElementById('externalMenuToggle');
                    if (sideMenu && !sideMenu.contains(e.target) &&
                        !toggle?.contains(e.target) &&
                        !externalToggle?.contains(e.target)) {
                        e.stopPropagation();
                        this.closeSideMenu();
                    }
                };

                this.handleOutsideShortlistMenuClick = (e) => {
                    const menu = document.getElementById('shortlistMenu');
                    const toggle = document.getElementById('shortlistMenuToggle');
                    const externalToggle = document.getElementById('externalShortlistToggle');
                    if (menu && !menu.contains(e.target) &&
                        !toggle?.contains(e.target) &&
                        !externalToggle?.contains(e.target)) {
                        this.closeShortlistMenu();
                    }
                };

                this.init();
            }

            isMobile() {
                return window.matchMedia('(max-width: 768px)').matches;
            }

            handleResponsive() {
                const mobile = this.isMobile();
                document.querySelectorAll('.tool-card').forEach(card => {
                    card.draggable = !mobile;
                });
                if (mobile) {
                    this.closeSideMenu();
                    this.closeShortlistMenu();
                }
            }

            init() {
                this.assignTags();
                this.setupInteractions();
                this.setupSearch();
                this.setupModals();
                this.setupSideMenu();
                this.setupShortlistMenu();
                this.setupBottomNav();
                this.updateCounts();
                this.populateCategoryTags();
                this.filterAndDisplayTools();
                this.applyViewStyles();

                this.handleResponsive();
                window.addEventListener('resize', () => this.handleResponsive());

                setTimeout(() => {
                    const loading = document.getElementById('loadingScreen');
                    if (loading) loading.style.display = 'none';
                }, 800);
            }

            assignTags() {
                this.TREASURY_TOOLS.forEach(tool => {
                    const tags = this.CATEGORY_TAGS[tool.category] || [];
                    tool.tags = [...tags].sort((a, b) => a.localeCompare(b));
                });
            }

            setupInteractions() {
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelector('.filter-tab.active')?.classList.remove('active');
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.category;
                        this.filterAndDisplayTools();
                    });
                });

                document.querySelectorAll('.category-header').forEach(header => {
                    header.addEventListener('click', (e) => {
                        if (e.target.closest('.show-more-category-tags-btn') ||
                            e.target.closest('.show-less-category-tags-btn')) {
                            return;
                        }

                        const category = header.dataset.category;
                        if (category && this.CATEGORY_INFO[category]) {
                            this.showCategoryModal(this.CATEGORY_INFO[category], category);
                        }
                    });
                });

                document.getElementById('mainContent').addEventListener('click', (e) => {
                    if (e.target.classList.contains('show-more-tags-btn')) {
                        e.stopPropagation();
                        const toolName = e.target.dataset.toolName;
                        const tool = this.TREASURY_TOOLS.find(t => t.name === toolName);
                        if (tool) {
                            const tagsContainer = e.target.parentElement;
                            const sortedTags = [...tool.tags].sort((a, b) => a.localeCompare(b));
                            tagsContainer.innerHTML = sortedTags.map(tag => `<span class="tool-tag">${tag}</span>`).join('');
                            tagsContainer.innerHTML += `<button class="show-less-tags-btn" data-tool-name="${tool.name}">Show less</button>`;
                        }
                    } else if (e.target.classList.contains('show-less-tags-btn')) {
                        e.stopPropagation();
                        const toolName = e.target.dataset.toolName;
                        const tool = this.TREASURY_TOOLS.find(t => t.name === toolName);
                        if (tool) {
                            const tagsContainer = e.target.parentElement;
                            const sortedTags = [...tool.tags].sort((a, b) => a.localeCompare(b));
                            const displayTags = sortedTags.slice(0, 3);
                            const hasMore = sortedTags.length > 3;
                            tagsContainer.innerHTML = displayTags.map(tag => `<span class="tool-tag">${tag}</span>`).join('');
                            if (hasMore) {
                                tagsContainer.innerHTML += `<button class="show-more-tags-btn" data-tool-name="${tool.name}">... more</button>`;
                            }
                        }
                    } else if (e.target.classList.contains('show-more-category-tags-btn')) {
                        e.stopPropagation();
                        const category = e.target.dataset.category;
                        const tagsContainer = e.target.parentElement;
                        const tags = this.CATEGORY_TAGS[category] || [];
                        const sorted = [...tags].sort((a, b) => a.localeCompare(b));
                        tagsContainer.innerHTML = sorted.map(tag => `<span class="category-tag">${tag}</span>`).join('');
                        tagsContainer.innerHTML += `<button class="show-less-category-tags-btn" data-category="${category}">Show less</button>`;
                    } else if (e.target.classList.contains('show-less-category-tags-btn')) {
                        e.stopPropagation();
                        const category = e.target.dataset.category;
                        const tagsContainer = e.target.parentElement;
                        const tags = this.CATEGORY_TAGS[category] || [];
                        const sorted = [...tags].sort((a, b) => a.localeCompare(b));
                        const displayTags = sorted.slice(0, 3);
                        const hasMore = sorted.length > 3;
                        tagsContainer.innerHTML = displayTags.map(tag => `<span class="category-tag">${tag}</span>`).join('');
                        if (hasMore) {
                            tagsContainer.innerHTML += `<button class="show-more-category-tags-btn" data-category="${category}">... more</button>`;
                        }
                    }
                });
            }

            setupSearch() {
                const searchInput = document.getElementById('searchInput');
                const searchClear = document.getElementById('searchClear');

                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchTerm = e.target.value.toLowerCase();
                        if (searchClear) searchClear.style.display = this.searchTerm ? 'block' : 'none';
                        this.filterAndDisplayTools();
                    });

                    searchInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            this.closeSideMenu();
                        }
                    });
                }

                if (searchClear) {
                    searchClear.addEventListener('click', () => {
                        if (searchInput) {
                            searchInput.value = '';
                            searchInput.focus(); // Keep focus on the input after clearing
                        }
                        this.searchTerm = '';
                        searchClear.style.display = 'none';
                        this.filterAndDisplayTools();
                    });
                }
            }

            setupTagSearch() {
                const searchInput = document.getElementById('tagSearchInput');
                const searchClear = document.getElementById('tagSearchClear');

                if (searchInput) {
                    searchInput.addEventListener('input', () => {
                        const term = searchInput.value.toLowerCase();
                        if (searchClear) searchClear.style.display = term ? 'block' : 'none';
                        this.filterTagCheckboxes(term);
                    });
                }

                if (searchClear) {
                    searchClear.addEventListener('click', () => {
                        if (searchInput) {
                            searchInput.value = '';
                            searchInput.focus();
                        }
                        searchClear.style.display = 'none';
                        this.filterTagCheckboxes('');
                    });
                }
            }

            filterTagCheckboxes(term) {
                const container = document.getElementById('tagFilters');
                if (!container) return;
                const items = container.querySelectorAll('.checkbox-item');
                items.forEach(item => {
                    const label = item.textContent.toLowerCase();
                    item.style.display = label.includes(term) ? 'flex' : 'none';
                });

                const showMore = document.getElementById('showMoreTagFilters');
                const showLess = document.getElementById('showLessTagFilters');
                const extra = document.getElementById('extraTagFilters');
                if (showMore && showLess && extra) {
                    if (term) {
                        extra.style.display = 'block';
                        showMore.style.display = 'none';
                        showLess.style.display = 'none';
                    } else {
                        extra.style.display = 'none';
                        showLess.style.display = 'none';
                        showMore.style.display = 'inline-block';
                    }
                }
            }

            setupModals() {
                const toolModal = document.getElementById('toolModal');
                const toolModalClose = document.getElementById('modalClose');

                if (toolModalClose) {
                    toolModalClose.addEventListener('click', () => this.closeModal('toolModal'));
                }
                if (toolModal) {
                    toolModal.addEventListener('click', (e) => {
                        if (e.target.closest('.modal-content') === null) this.closeModal('toolModal');
                    });
                }

                const categoryModal = document.getElementById('categoryModal');
                const categoryModalClose = document.getElementById('categoryModalClose');

                if (categoryModalClose) {
                    categoryModalClose.addEventListener('click', () => this.closeModal('categoryModal'));
                }
                if (categoryModal) {
                    categoryModal.addEventListener('click', (e) => {
                        if (e.target.closest('.modal-content') === null) this.closeModal('categoryModal');
                    });
                }

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeModal('toolModal');
                        this.closeModal('categoryModal');
                    }
                });

                window.addEventListener('message', (e) => {
                    if (e.origin.includes('youtube.com') && typeof e.data === 'string') {
                        try {
                            const data = JSON.parse(e.data);
                            if (data.event === 'infoDelivery' && typeof data.info === 'number' && data.id) {
                                const key = data.id.replace(/^yt-/, '');
                                this.videoTimes[key] = data.info;
                            }
                        } catch (_) {}
                    }
                });
            }
            
            openModal(modal) {
                if (modal) {
                    this.previousFocusedElement = document.activeElement;
                    modal.classList.add('show');
                    document.body.classList.add('modal-open');

                    // Always focus the modal container so space/enter
                    // do not trigger the close button by default
                    const content = modal.querySelector('.modal-content');
                    if (content) content.focus();
                }
            }

            showToolModal(tool) {
                const modal = document.getElementById('toolModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalDescription = document.getElementById('modalDescription');
                const modalWebsiteLink = document.getElementById('modalWebsiteLink');
                const modalBody = modal?.querySelector('.modal-body');
                const modalTags = document.getElementById('modalTags');
                const modalLogo = document.getElementById('modalToolLogo');

                this.currentToolId = tool.name.replace(/\s+/g, '-').toLowerCase();

                if (!modal || !modalBody) return;

                // 1. Update the static content first
                if (modalTitle) modalTitle.textContent = tool.name;
                if (modalDescription) modalDescription.textContent = tool.desc;

                if (modalWebsiteLink) {
                    if (tool.websiteUrl) {
                        modalWebsiteLink.href = tool.websiteUrl;
                        modalWebsiteLink.style.display = 'inline-flex';
                    } else {
                        modalWebsiteLink.style.display = 'none';
                    }
                }

                if (modalLogo) {
                    if (tool.logoUrl) {
                        modalLogo.src = tool.logoUrl;
                        modalLogo.alt = `${tool.name} logo`;
                        modalLogo.style.display = 'block';
                    } else {
                        modalLogo.style.display = 'none';
                    }
                }

                if (modalTags) {
                    const tags = tool.tags || this.CATEGORY_TAGS[tool.category] || [];
                    const sorted = [...tags].sort((a, b) => a.localeCompare(b));
                    modalTags.innerHTML = sorted.map(tag => `<span class="tool-tag">${tag}</span>`).join('');
                }

                // 2. Remove any video section from a previous click
                let existingVideoSection = modalBody.querySelector('.video-demo-section');
                if (existingVideoSection && existingVideoSection.dataset.toolId !== this.currentToolId) {
                    existingVideoSection.remove();
                    existingVideoSection = null;
                }

                // 3. Add a new video section if the current tool has one
                const videoSection = existingVideoSection || document.createElement('div');
                videoSection.className = 'feature-section video-demo-section';
                videoSection.dataset.toolId = this.currentToolId;
                if (tool.videoUrl) {
                    const resume = this.videoTimes[this.currentToolId] || 0;
                    if (tool.videoUrl.includes('youtu.be/') || tool.videoUrl.includes('youtube.com/watch')) {
                        let embedUrl = tool.videoUrl;
                        if (tool.videoUrl.includes('youtu.be/')) {
                            const videoId = tool.videoUrl.split('youtu.be/')[1].split('?')[0];
                            embedUrl = `https://www.youtube.com/embed/${videoId}`;
                        } else {
                            const videoId = new URL(tool.videoUrl).searchParams.get('v');
                            embedUrl = `https://www.youtube.com/embed/${videoId}`;
                        }
                        embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'enablejsapi=1&playsinline=1';
                        if (resume) embedUrl += `&start=${Math.floor(resume)}&autoplay=1`;
                        videoSection.innerHTML = `
                            <h4>ðŸŽ¥ Product Differentiator</h4>
                            <div class="video-container">
                                <iframe id="yt-${this.currentToolId}" src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" playsinline></iframe>
                            </div>
                        `;
                        const iframe = videoSection.querySelector('iframe');
                        if (iframe && resume) {
                            iframe.addEventListener('load', () => {
                                iframe.contentWindow.postMessage(JSON.stringify({event:'command', func:'seekTo', args:[resume, true], id: `yt-${this.currentToolId}`}), 'https://www.youtube.com');
                                iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', 'https://www.youtube.com');
                            }, { once: true });
                        }
                    } else {
                        videoSection.innerHTML = `
                            <h4>ðŸŽ¥ Product Differentiator</h4>
                            <div class="video-container">
                                <video src="${tool.videoUrl}" controls playsinline></video>
                            </div>
                        `;
                        const vid = videoSection.querySelector('video');
                        if (vid && resume) {
                            vid.addEventListener('loadedmetadata', () => {
                                vid.currentTime = resume;
                                vid.play();
                            }, { once: true });
                        }
                    }
                } else {
                    videoSection.innerHTML = `
                        <h4>ðŸŽ¥ Demo Coming Soon</h4>
                    `;
                }

                // Always place the video or demo section at the end of the modal
                // body so informational text appears below the other details
                modalBody.appendChild(videoSection);

                // 4. Show the modal
                this.openModal(modal);

                // Allow space bar to control video playback without
                // accidentally activating the close button
                const content = modal.querySelector('.modal-content');
                if (content) {
                    const handler = (e) => {
                        if (e.code === 'Space' || e.key === ' ') {
                            const vid = modal.querySelector('video');
                            const iframe = modal.querySelector('iframe');
                            if (vid) {
                                e.preventDefault();
                                vid.paused ? vid.play() : vid.pause();
                            } else if (iframe && iframe.contentWindow) {
                                e.preventDefault();
                                iframe.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', 'https://www.youtube.com');
                            }
                        }
                    };
                    content.addEventListener('keydown', handler);
                    this.spaceHandler = { el: content, fn: handler };
                }
            }

            showCategoryModal(categoryInfo, categoryKey) {
                const modal = document.getElementById('categoryModal');
                const modalTitle = document.getElementById('categoryModalTitle');
                const modalDescription = document.getElementById('categoryModalDescription');
                const modalFeatures = document.getElementById('categoryModalFeatures');
                const modalBody = modal?.querySelector('.modal-body');

                if (modalTitle) modalTitle.textContent = categoryInfo.name;
                if (modalDescription) modalDescription.textContent = categoryInfo.description;

                if (modalFeatures) {
                    modalFeatures.innerHTML = '';
                    categoryInfo.features.forEach(feature => {
                        const li = document.createElement('li');
                        li.textContent = feature;
                        modalFeatures.appendChild(li);
                    });
                }
                
                // Clear previous dynamic content
                const existingVideoSection = modalBody?.querySelector('.video-demo-section');
                if (existingVideoSection) {
                    existingVideoSection.remove();
                }

                if (modalBody) {
                    const videoSection = document.createElement('div');
                    videoSection.className = 'feature-section video-demo-section';
                    if (categoryInfo.videoUrl) {
                        if (categoryInfo.videoUrl.includes('youtu.be/') || categoryInfo.videoUrl.includes('youtube.com/watch')) {
                            let embedUrl = categoryInfo.videoUrl;
                            if (categoryInfo.videoUrl.includes('youtu.be/')) {
                                const videoId = categoryInfo.videoUrl.split('youtu.be/')[1].split('?')[0];
                                embedUrl = `https://www.youtube.com/embed/${videoId}`;
                            } else {
                                const videoId = new URL(categoryInfo.videoUrl).searchParams.get('v');
                                embedUrl = `https://www.youtube.com/embed/${videoId}`;
                            }
                            embedUrl += (embedUrl.includes('?') ? '&' : '?') + 'enablejsapi=1&playsinline=1';
                            videoSection.innerHTML = `
                                <h4>ðŸŽ¥ Category Overview Video</h4>
                                <div class="video-container">
                                     <iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy" playsinline></iframe>
                                </div>
                            `;
                        } else {
                            videoSection.innerHTML = `
                                <h4>ðŸŽ¥ Category Overview Video</h4>
                                <div class="video-container">
                                     <video src="${categoryInfo.videoUrl}" controls playsinline></video>
                                </div>
                            `;
                        }
                    } else {
                        videoSection.innerHTML = `
                            <h4>ðŸŽ¥ Demo Coming</h4>
                        `;
                    }

                    // Place demo information after existing content
                    modalBody.appendChild(videoSection);
                }

                this.openModal(modal);
            }

            closeModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal && modal.classList.contains('show')) {
                    modal.classList.remove('show');
                    document.body.classList.remove('modal-open');

                    if (modalId === 'toolModal' && this.currentToolId) {
                        const key = this.currentToolId;

                        modal.querySelectorAll('iframe').forEach(iframe => {
                            if (iframe.src.includes('youtube.com') && iframe.contentWindow) {
                                iframe.contentWindow.postMessage(JSON.stringify({event:'command', func:'getCurrentTime', id: `yt-${key}`}), 'https://www.youtube.com');
                                iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', 'https://www.youtube.com');
                            }
                        });

                        modal.querySelectorAll('video').forEach(video => {
                            this.videoTimes[key] = video.currentTime;
                            video.pause();
                        });
                    } else {
                        modal.querySelectorAll('iframe').forEach(iframe => {
                            if (iframe.src.includes('youtube.com') && iframe.contentWindow) {
                                iframe.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', 'https://www.youtube.com');
                            }
                        });

                        modal.querySelectorAll('video').forEach(video => {
                            video.pause();
                        });
                    }

                    if (this.previousFocusedElement) {
                        this.previousFocusedElement.focus();
                        this.previousFocusedElement = null;
                    }
                    if (modalId === 'toolModal') {
                        if (this.spaceHandler) {
                            const { el, fn } = this.spaceHandler;
                            el.removeEventListener('keydown', fn);
                            this.spaceHandler = null;
                        }
                        this.currentToolId = null;
                    }
                }
            }

            filterAndDisplayTools() {
                let tools;

                if (this.searchTerm) {
                    const lowerCaseSearchTerm = this.searchTerm.toLowerCase();
                    tools = this.TREASURY_TOOLS.filter(tool => {
                        const searchableText = [
                            tool.name,
                            tool.desc,
                            tool.target,
                            ...(tool.tags || []),
                            ...(tool.features || [])
                        ].join(' ').toLowerCase();

                        return searchableText.includes(lowerCaseSearchTerm);
                    });
                } else {
                    tools = this.currentFilter === 'ALL' ?
                        this.TREASURY_TOOLS :
                        this.TREASURY_TOOLS.filter(tool => tool.category === this.currentFilter);
                }

                // Advanced Filters
                if (this.advancedFilters.features.length) {
                    tools = tools.filter(t => this.advancedFilters.features.every(f => (t.tags || []).includes(f)));
                }
                if (this.advancedFilters.hasVideo) {
                    tools = tools.filter(t => t.videoUrl);
                }

                // Sorting
                if (this.currentSort === 'name') {
                    tools = tools.sort((a, b) => a.name.localeCompare(b.name));
                } else if (this.currentSort === 'category') {
                    tools = tools.sort((a, b) => a.category.localeCompare(b.category));
                }

                this.filteredTools = tools;
                this.displayFilteredTools();
                this.updateVisibleCounts();
            }

            displayFilteredTools() {
                const categories = ['CASH', 'LITE', 'TRMS'];
                const hasResults = this.filteredTools.length > 0;

                const noResults = document.getElementById('noResults');
                if (noResults) noResults.style.display = hasResults ? 'none' : 'block';

                const listContainer = document.getElementById('listViewContainer');
                const ungroup = !this.groupByCategory || this.currentView === 'list' || this.searchTerm ||
                                this.advancedFilters.features.length || this.advancedFilters.hasVideo;

                if (ungroup) {
                    categories.forEach(cat => {
                        const section = document.querySelector(`.category-section[data-category="${cat}"]`);
                        if (section) section.style.display = 'none';
                    });
                    if (listContainer) {
                        listContainer.innerHTML = '';
                        this.filteredTools.sort((a,b) => a.name.localeCompare(b.name)).forEach(tool => {
                            const card = this.createToolCard(tool, tool.category);
                            listContainer.appendChild(card);
                        });
                        listContainer.style.display = hasResults ? 'grid' : 'none';
                    }
                    return;
                } else {
                    if (listContainer) listContainer.style.display = 'none';
                }

                categories.forEach(category => {
                    const section = document.querySelector(`.category-section[data-category="${category}"]`);
                    const container = document.getElementById(`tools-${category}`);
                    const categoryTools = this.filteredTools
                        .filter(tool => tool.category === category)
                        .sort((a, b) => a.name.localeCompare(b.name));

                    // Clear the container first
                    if (container) {
                        container.innerHTML = '';
                    }

                    // Determine if this section should be visible
                    let shouldShowSection = false;

                    if (this.searchTerm) {
                        // When searching, show section only if it has matching tools
                        shouldShowSection = categoryTools.length > 0;
                    } else {
                        // When filtering by category, show section if it matches filter and has tools
                        shouldShowSection = (this.currentFilter === 'ALL' || this.currentFilter === category) && categoryTools.length > 0;
                    }

                    // Show/hide the section
                    if (section) {
                        section.style.display = shouldShowSection ? 'block' : 'none';
                    }

                    // Populate the container only if section is visible
                    if (shouldShowSection && container) {
                        categoryTools.forEach(tool => {
                            const card = this.createToolCard(tool, category);
                            container.appendChild(card);
                        });
                    }
                });
            }

            createToolCard(tool, category) {
                const card = document.createElement('div');
                card.className = `tool-card tool-${category.toLowerCase()}`;
                card.draggable = !this.isMobile();
                card.dataset.name = tool.name;

                const iconMap = {
                    'TRMS': 'ðŸ¢',
                    'CASH': 'ðŸ’°',
                    'LITE': 'âš¡'
                };

                const tags = tool.tags || this.CATEGORY_TAGS[tool.category] || [];
                const sortedTags = [...tags].sort((a, b) => a.localeCompare(b));
                const displayTags = sortedTags.slice(0, 3);
                const hasMoreTags = sortedTags.length > 3;

                card.innerHTML = `
                    <div class="tool-card-content">
                        <div class="tool-header">
                            <div class="tool-info">
                                <div class="tool-name">
                                    <span class="tool-name-title">${tool.name}</span>
                                    ${tool.videoUrl ? '<span class="video-indicator">ðŸŽ¥</span>' : ''}
                                    ${tool.logoUrl ? `<img class="tool-logo-inline" src="${tool.logoUrl}" alt="${tool.name} logo">` : ''}
                                </div>
                                <div class="tool-type">${tool.category === 'CASH' ? 'Cash Tools' : tool.category === 'LITE' ? 'TMS-Lite' : tool.category}</div>
                            </div>
                            <div class="tool-meta">
                                ${tool.websiteUrl ? `<a class="tool-website-link" href="${tool.websiteUrl}" target="_blank" rel="noopener noreferrer">Website</a>` : ''}
                                <div class="tool-icon">${iconMap[tool.category]}</div>
                            </div>
                        </div>
                        <div class="tool-description">${tool.desc}</div>
                    </div>
                    <div class="tool-card-actions">
                        <div class="tool-tags">
                            ${displayTags.map(tag => `<span class="tool-tag">${tag}</span>`).join('')}
                            ${hasMoreTags ? `<button class="show-more-tags-btn" data-tool-name="${tool.name}">... more</button>` : ''}
                        </div>
                    </div>
                `;

                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.show-more-tags-btn') &&
                        !e.target.closest('.show-less-tags-btn')) {
                        this.showToolModal(tool);
                    }
                });

                if (!this.isMobile()) {
                    card.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', tool.name);
                        this.openShortlistMenu('dragstart');
                    });

                    card.addEventListener('touchstart', () => {
                        this.touchDragTool = tool;
                        this.openShortlistMenu();
                    });
                    card.addEventListener('touchmove', (e) => {
                        const container = document.getElementById('shortlistContainer');
                        if (!container) return;
                        const touch = e.touches[0];
                        const el = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (el && container.contains(el)) {
                            container.classList.add('drag-over');
                        } else {
                            container.classList.remove('drag-over');
                        }
                        e.preventDefault();
                    }, { passive: false });
                    card.addEventListener('touchend', (e) => {
                        const container = document.getElementById('shortlistContainer');
                        if (container) {
                            container.classList.remove('drag-over');
                        }
                        if (this.touchDragTool && container) {
                            const touch = e.changedTouches[0];
                            const el = document.elementFromPoint(touch.clientX, touch.clientY);
                            if (el && container.contains(el) && !this.shortlist.some(i => i.tool.name === this.touchDragTool.name)) {
                                this.shortlist.push({ tool: this.touchDragTool, notes: '' });
                                this.renderShortlist();
                            }
                        }
                        this.touchDragTool = null;
                    });
                }

                return card;
            }

            populateCategoryTags() {
                const categories = ['CASH', 'LITE', 'TRMS'];
                categories.forEach(category => {
                    const container = document.getElementById(`category-tags-${category}`);
                    if (container) {
                        const tags = this.CATEGORY_TAGS[category] || [];
                        const sorted = [...tags].sort((a, b) => a.localeCompare(b));
                        const displayTags = sorted.slice(0, 3);
                        const hasMore = sorted.length > 3;
                        container.innerHTML = displayTags.map(tag => `<span class="category-tag">${tag}</span>`).join('');
                        if (hasMore) {
                            container.innerHTML += `<button class="show-more-category-tags-btn" data-category="${category}">... more</button>`;
                        }
                    }
                });
            }

            populateTagFilters() {
                const container = document.getElementById('tagFilters');
                if (!container) return;
                const tags = [...new Set(Object.values(this.CATEGORY_TAGS).flat())].sort((a, b) => a.localeCompare(b));
                this.allTags = tags;
                const displayCount = 4;
                const visible = tags.slice(0, displayCount);
                const hidden = tags.slice(displayCount);
                const makeCb = (tag) => {
                    const id = `tag-${tag.replace(/[^a-z0-9]+/gi, '-').toLowerCase()}`;
                    return `<div class="checkbox-item"><input type="checkbox" id="${id}" value="${tag}"><label for="${id}">${tag}</label></div>`;
                };
                container.innerHTML = visible.map(makeCb).join('');
                if (hidden.length) {
                    container.innerHTML += `<div id="extraTagFilters" style="display:none;">${hidden.map(makeCb).join('')}</div>`;
                    container.innerHTML += `<button class="show-more-filter-tags-btn" id="showMoreTagFilters">Show more</button>`;
                    container.innerHTML += `<button class="show-less-filter-tags-btn" id="showLessTagFilters" style="display:none;">Show less</button>`;
                }
            }

            updateVisibleCounts() {
                const categories = ['CASH', 'LITE', 'TRMS'];
                let visibleTotal = 0;
                categories.forEach(category => {
                    const count = this.filteredTools.filter(tool => tool.category === category).length;
                    const countElement = document.getElementById(`count-${category}`);
                    if (countElement) {
                        countElement.textContent = count;
                    }
                    visibleTotal += count;
                });

                const totalTools = document.getElementById('totalTools');
                if (totalTools) {
                    totalTools.textContent = this.searchTerm ? visibleTotal : this.TREASURY_TOOLS.length;
                }
            }

            updateCounts() {
                const categories = ['CASH', 'LITE', 'TRMS'];
                categories.forEach(category => {
                    const count = this.TREASURY_TOOLS.filter(tool => tool.category === category).length;
                    const countElement = document.getElementById(`count-${category}`);
                    if (countElement) {
                        countElement.textContent = count;
                    }
                });

                const totalTools = document.getElementById('totalTools');
                if (totalTools) {
                    totalTools.textContent = this.TREASURY_TOOLS.length;
                }
            }

            setupSideMenu() {

                const menuToggle = document.getElementById('sideMenuToggle');
                const externalMenuToggle = document.getElementById('externalMenuToggle');
                const sideMenu = document.getElementById('sideMenu');
                const overlay = document.getElementById('sideMenuOverlay');

                if (menuToggle) menuToggle.addEventListener('click', () => this.toggleSideMenu());
                if (externalMenuToggle) externalMenuToggle.addEventListener('click', () => this.toggleSideMenu());
                if (overlay) overlay.addEventListener('click', () => this.closeSideMenu());
                if (sideMenu) sideMenu.addEventListener('click', (e) => {
                    if (this.isMobile()) return;
                    if (!this.sideMenuOpen && e.target === sideMenu) {
                        e.stopPropagation();
                        this.openSideMenu();
                    }
                });

                this.setupAdvancedFilters();
                this.setupViewOptions();
                this.setupQuickActions();

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.sideMenuOpen) this.closeSideMenu();
                });
            }

            setupAdvancedFilters() {
                this.populateTagFilters();
                this.setupTagSearch();
                const showMore = document.getElementById('showMoreTagFilters');
                const showLess = document.getElementById('showLessTagFilters');
                const extra = document.getElementById('extraTagFilters');
                if (showMore && showLess && extra) {
                    showMore.addEventListener('click', () => {
                        extra.style.display = 'block';
                        showMore.style.display = 'none';
                        showLess.style.display = 'inline-block';
                    });
                    showLess.addEventListener('click', () => {
                        extra.style.display = 'none';
                        showLess.style.display = 'none';
                        showMore.style.display = 'inline-block';
                    });
                }

                const featureCheckboxes = document.querySelectorAll('#tagFilters input[type="checkbox"]');
                featureCheckboxes.forEach(cb => {
                    cb.addEventListener('change', () => {
                        this.updateFeatureFilters();
                        this.filterAndDisplayTools();
                        this.updateFilterCount();
                    });
                });

                const hasVideoFilter = document.getElementById('hasVideoFilter');
                if (hasVideoFilter) {
                    hasVideoFilter.addEventListener('change', (e) => {
                        this.advancedFilters.hasVideo = e.target.checked;
                        this.filterAndDisplayTools();
                        this.updateFilterCount();
                    });
                }

                const sortFilter = document.getElementById('sortFilter');
                if (sortFilter) {
                    sortFilter.addEventListener('change', (e) => {
                        this.currentSort = e.target.value;
                        this.filterAndDisplayTools();
                    });
                }
            }

            setupViewOptions() {
                const viewOptions = document.querySelectorAll('.view-option');
                viewOptions.forEach(opt => {
                    opt.addEventListener('click', () => {
                        viewOptions.forEach(o => o.classList.remove('active'));
                        opt.classList.add('active');
                        this.currentView = opt.dataset.view;
                        this.applyViewStyles();
                    });
                });

                const groupByFilter = document.getElementById('groupByFilter');
                if (groupByFilter) {
                    groupByFilter.addEventListener('change', (e) => {
                        this.groupByCategory = e.target.value === 'category';
                        this.filterAndDisplayTools();
                    });
                }
            }

            setupQuickActions() {
                const clearAll = document.getElementById('clearAllFilters');
                if (clearAll) clearAll.addEventListener('click', () => this.clearAllFilters());

                const resetBtn = document.getElementById('resetToDefaults');
                if (resetBtn) resetBtn.addEventListener('click', () => this.resetToDefaults());

                const applyBtn = document.getElementById('applyFilters');
                if (applyBtn) applyBtn.addEventListener('click', () => {
                    this.filterAndDisplayTools();
                    this.closeSideMenu();
                });
            }

            toggleSideMenu() {
                if (this.sideMenuOpen) this.closeSideMenu();
                else this.openSideMenu();
            }

            openSideMenu() {
                this.closeShortlistMenu();
                const sideMenu = document.getElementById('sideMenu');
                const overlay = document.getElementById('sideMenuOverlay');
                const toggle = document.getElementById('sideMenuToggle');
                const externalToggle = document.getElementById('externalMenuToggle');
                const bottomToggle = document.getElementById('bottomSearch');

                sideMenu?.classList.add('open');
                document.body.classList.add('side-menu-open');
                overlay?.classList.add('show');
                toggle?.classList.add('active');
                externalToggle?.classList.add('active');
                bottomToggle?.classList.add('active');
                document.body.style.overflow = 'hidden';
                document.addEventListener('click', this.handleOutsideSideMenuClick, true);
                this.sideMenuOpen = true;
            }

            closeSideMenu() {
                const sideMenu = document.getElementById('sideMenu');
                const overlay = document.getElementById('sideMenuOverlay');
                const toggle = document.getElementById('sideMenuToggle');
                const externalToggle = document.getElementById('externalMenuToggle');
                const bottomToggle = document.getElementById('bottomSearch');

                sideMenu?.classList.remove('open');
                overlay?.classList.remove('show');
                toggle?.classList.remove('active');
                externalToggle?.classList.remove('active');
                bottomToggle?.classList.remove('active');
                document.body.classList.remove('side-menu-open');
                document.body.style.overflow = '';
                document.removeEventListener('click', this.handleOutsideSideMenuClick, true);
                this.sideMenuOpen = false;
            }

            setupShortlistMenu() {

                const menuToggle = document.getElementById('shortlistMenuToggle');
                const overlay = document.getElementById('shortlistMenuOverlay');
                const externalToggle = document.getElementById('externalShortlistToggle');
                const container = document.getElementById('shortlistContainer');
                const clearBtn = document.getElementById('clearShortlist');
                const exportBtn = document.getElementById('exportShortlistBtn');

                if (menuToggle) menuToggle.addEventListener('click', () => this.toggleShortlistMenu());
                if (externalToggle) externalToggle.addEventListener('click', () => this.toggleShortlistMenu());
                if (overlay) {
                    overlay.addEventListener('dragover', e => e.preventDefault());
                    overlay.addEventListener('drop', e => e.preventDefault());
                }
                const shortlistMenu = document.getElementById('shortlistMenu');
                if (shortlistMenu) shortlistMenu.addEventListener('click', (e) => {
                    if (this.isMobile()) return;
                    if (!this.shortlistMenuOpen && e.target === shortlistMenu) {
                        e.stopPropagation();
                        this.openShortlistMenu();
                    }
                });
                if (clearBtn) clearBtn.addEventListener('click', () => this.clearShortlist());
                if (exportBtn) exportBtn.addEventListener('click', () => this.exportShortlist());

                if (container) {
                    let draggedCard = null;
                    let touchDraggedCard = null;
                    const addHighlight = () => container.classList.add('drag-over');
                    const removeHighlight = () => container.classList.remove('drag-over');

                    container.addEventListener('dragstart', e => {
                        if (e.target.classList.contains('shortlist-card')) {
                            draggedCard = e.target;
                            e.dataTransfer.setData('text/plain', e.target.dataset.name);
                            e.dataTransfer.effectAllowed = 'move';
                        } else {
                            draggedCard = null;
                        }
                    });

                    container.addEventListener('dragenter', addHighlight);
                    container.addEventListener('dragleave', e => {
                        if (e.target === container) removeHighlight();
                    });
                    container.addEventListener('dragover', e => {
                        e.preventDefault();
                        if (draggedCard) {
                            const target = e.target.closest('.shortlist-card');
                            if (target && target !== draggedCard) {
                                const rect = target.getBoundingClientRect();
                                const next = (e.clientY - rect.top) > rect.height / 2;
                                container.insertBefore(draggedCard, next ? target.nextSibling : target);
                            }
                        }
                    });
                    container.addEventListener('drop', e => {
                        e.preventDefault();
                        removeHighlight();
                        if (draggedCard) {
                            this.shortlist = Array.from(container.querySelectorAll('.shortlist-card')).map(card => {
                                const name = card.dataset.name;
                                return this.shortlist.find(i => i.tool.name === name);
                            });
                            draggedCard = null;
                            this.renderShortlist();
                        } else {
                            const name = e.dataTransfer.getData('text/plain');
                            const tool = this.TREASURY_TOOLS.find(t => t.name === name);
                            if (tool && !this.shortlist.some(i => i.tool.name === name)) {
                                this.shortlist.push({ tool, notes: '' });
                                this.renderShortlist();
                            }
                        }
                    });

                    container.addEventListener('touchstart', e => {
                        const card = e.target.closest('.shortlist-card');
                        if (card) {
                            touchDraggedCard = card;
                            addHighlight();
                        }
                    });
                    container.addEventListener('touchmove', e => {
                        if (!touchDraggedCard) return;
                        const touch = e.touches[0];
                        const target = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.shortlist-card');
                        if (target && target !== touchDraggedCard) {
                            const rect = target.getBoundingClientRect();
                            const next = (touch.clientY - rect.top) > rect.height / 2;
                            container.insertBefore(touchDraggedCard, next ? target.nextSibling : target);
                        }
                        e.preventDefault();
                    }, { passive: false });
                    container.addEventListener('touchend', () => {
                        if (!touchDraggedCard) return;
                        removeHighlight();
                        this.shortlist = Array.from(container.querySelectorAll('.shortlist-card')).map(card => {
                            const name = card.dataset.name;
                            return this.shortlist.find(i => i.tool.name === name);
                        });
                        touchDraggedCard = null;
                        this.renderShortlist();
                    });

                    container.addEventListener('click', e => {
                        if (e.target === container && !container.querySelector('#toolPicker')) {
                            this.openToolPicker();
                        }
                    });
                }

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.shortlistMenuOpen) this.closeShortlistMenu();
                });

                this.renderShortlist();
            }

            toggleShortlistMenu() {
                if (this.shortlistMenuOpen) this.closeShortlistMenu();
                else this.openShortlistMenu();
            }

            openShortlistMenu(trigger) {
                this.closeSideMenu();
                const menu = document.getElementById('shortlistMenu');
                const overlay = document.getElementById('shortlistMenuOverlay');
                const toggle = document.getElementById('shortlistMenuToggle');
                const externalToggle = document.getElementById('externalShortlistToggle');
                const bottomToggle = document.getElementById('bottomShortlist');

                menu?.classList.add('open');
                document.body.classList.add('shortlist-menu-open');
                overlay?.classList.add('show');
                document.addEventListener('click', this.handleOutsideShortlistMenuClick);
               toggle?.classList.add('active');
               externalToggle?.classList.add('active');
               bottomToggle?.classList.add('active');
               document.body.style.overflow = 'hidden';
               this.shortlistMenuOpen = true;
            }

            closeShortlistMenu() {
                const menu = document.getElementById('shortlistMenu');
                const overlay = document.getElementById('shortlistMenuOverlay');
                const toggle = document.getElementById('shortlistMenuToggle');
                const externalToggle = document.getElementById('externalShortlistToggle');
                const bottomToggle = document.getElementById('bottomShortlist');

                menu?.classList.remove('open');
                document.body.classList.remove('shortlist-menu-open');
                overlay?.classList.remove('show');
                document.removeEventListener('click', this.handleOutsideShortlistMenuClick);
               toggle?.classList.remove('active');
               externalToggle?.classList.remove('active');
               bottomToggle?.classList.remove('active');
               document.body.style.overflow = '';
               this.shortlistMenuOpen = false;
            }

            renderShortlist() {
                const container = document.getElementById('shortlistContainer');
                const emptyMsg = document.getElementById('shortlistEmptyMessage');
                if (!container) return;

                container.innerHTML = '';

                if (emptyMsg) container.appendChild(emptyMsg);

                if (this.shortlist.length === 0) {
                    container.classList.add('empty');
                    if (emptyMsg) emptyMsg.classList.remove('visually-hidden');
                } else {
                    container.classList.remove('empty');
                    if (emptyMsg) emptyMsg.classList.add('visually-hidden');

                    this.shortlist.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'shortlist-card';
                        div.draggable = true;
                        div.dataset.name = item.tool.name;
                        div.innerHTML = `
                            <div class="shortlist-card-header">
                                <div class="shortlist-card-title-wrapper">
                                    ${item.tool.logoUrl ? `<img class="shortlist-logo" src="${item.tool.logoUrl}" alt="${item.tool.name} logo">` : ''}
                                    <span class="shortlist-card-title">${item.tool.name}</span>
                                    ${item.tool.websiteUrl ? `<a class="shortlist-card-link" href="${item.tool.websiteUrl}" target="_blank" rel="noopener noreferrer">Visit<br>Website</a>` : ''}
                                </div>
                                <div class="shortlist-card-buttons">
                                    <button class="move-up" data-name="${item.tool.name}" aria-label="Move up">â–²</button>
                                    <button class="move-down" data-name="${item.tool.name}" aria-label="Move down">â–¼</button>
                                    <button class="remove-shortlist" data-name="${item.tool.name}" aria-label="Remove">Ã—</button>
                                </div>
                            </div>
                            <textarea class="shortlist-note" data-name="${item.tool.name}" placeholder="Notes...">${item.notes || ''}</textarea>`;
                        container.appendChild(div);
                    });
                }
                container.querySelectorAll('.remove-shortlist').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const name = e.target.dataset.name;
                        this.shortlist = this.shortlist.filter(i => i.tool.name !== name);
                        this.renderShortlist();
                    });
                });
                container.querySelectorAll('.move-up').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const name = e.target.dataset.name;
                        const idx = this.shortlist.findIndex(i => i.tool.name === name);
                        if (idx > 0) {
                            const [item] = this.shortlist.splice(idx, 1);
                            this.shortlist.splice(idx - 1, 0, item);
                            this.renderShortlist();
                        }
                    });
                });
                container.querySelectorAll('.move-down').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const name = e.target.dataset.name;
                        const idx = this.shortlist.findIndex(i => i.tool.name === name);
                        if (idx < this.shortlist.length - 1 && idx !== -1) {
                            const [item] = this.shortlist.splice(idx, 1);
                            this.shortlist.splice(idx + 1, 0, item);
                            this.renderShortlist();
                        }
                    });
                });
                container.querySelectorAll('.shortlist-note').forEach(area => {
                    area.addEventListener('input', (e) => {
                        const name = e.target.dataset.name;
                        const item = this.shortlist.find(i => i.tool.name === name);
                        if (item) item.notes = e.target.value;
                    });
                });

                const exportBtn = document.getElementById('exportShortlistBtn');
                if (exportBtn) {
                    exportBtn.disabled = this.shortlist.length === 0;
                }
            }

            clearShortlist() {
                this.shortlist = [];
                this.renderShortlist();
            }

            openToolPicker() {
                const container = document.getElementById('shortlistContainer');
                if (!container) return;
                const existing = document.getElementById('toolPicker');
                if (existing) existing.remove();
                const select = document.createElement('select');
                select.id = 'toolPicker';
                select.innerHTML = '<option value="" disabled selected>Select a tool</option>' +
                    this.TREASURY_TOOLS.filter(t => !this.shortlist.some(i => i.tool.name === t.name))
                        .map(t => `<option value="${t.name}">${t.name}</option>`).join('');
                select.addEventListener('change', () => {
                    const name = select.value;
                    const tool = this.TREASURY_TOOLS.find(t => t.name === name);
                    if (tool && !this.shortlist.some(i => i.tool.name === name)) {
                        this.shortlist.push({ tool, notes: '' });
                        this.renderShortlist();
                    }
                    select.remove();
                });
                container.appendChild(select);
                select.focus();
            }

            setupBottomNav() {
                const search = document.getElementById('bottomSearch');
                const shortlist = document.getElementById('bottomShortlist');

                if (search) {
                    search.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        if (this.sideMenuOpen) {
                            this.closeSideMenu();
                        } else {
                            this.openSideMenu();

                            // Add delay to ensure menu animation completes
                            setTimeout(() => {
                                const input = document.getElementById('searchInput');
                                if (input) {
                                    input.focus();
                                    // For iOS Safari - trigger click as well
                                    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                                        input.click();
                                    }
                                }
                            }, 350); // Match the menu transition duration
                        }
                    });
                }

                if (shortlist) {
                    shortlist.addEventListener('click', e => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.toggleShortlistMenu();
                    });
                    shortlist.addEventListener('touchend', e => {
                        e.preventDefault();
                        e.stopPropagation();
                        this.toggleShortlistMenu();
                    });
                }
            }


            updateFeatureFilters() {
                const cbs = document.querySelectorAll('#tagFilters input[type="checkbox"]');
                this.advancedFilters.features = Array.from(cbs).filter(cb => cb.checked).map(cb => cb.value);
            }

            applyViewStyles() {
                const grids = document.querySelectorAll('.tools-grid');
                grids.forEach(grid => {
                    grid.classList.remove('list-view');
                    if (this.currentView === 'list') {
                        grid.classList.add('list-view');
                        grid.style.gridTemplateColumns = '1fr';
                    } else {
                        grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(320px, 1fr))';
                    }
                });
            }

            exportShortlist() {
                const data = this.shortlist.map(item => ({
                    name: item.tool.name,
                    category: item.tool.category,
                    website: item.tool.websiteUrl ? item.tool.websiteUrl.split('?')[0] : '',
                    notes: item.notes || ''
                }));
                const csv = this.convertToCSV(data);
                this.downloadCSV(csv, 'shortlist.csv');
            }

            convertToCSV(data) {
                if (!data.length) return '';
                const headers = Object.keys(data[0]);
                return [
                    headers.join(','),
                    ...data.map(row => headers.map(h => `"${String(row[h]).replace(/"/g,'""')}"`).join(','))
                ].join('\n');
            }

            downloadCSV(csv, filename) {
                const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
                const link = document.createElement('a');
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', filename);
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    URL.revokeObjectURL(url);
                    document.body.removeChild(link);
                }
            }

            clearAllFilters() {
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.value = '';
                    this.searchTerm = '';
                }
                const tagSearchInput = document.getElementById('tagSearchInput');
                if (tagSearchInput) {
                    tagSearchInput.value = '';
                }
                const tagSearchClear = document.getElementById('tagSearchClear');
                if (tagSearchClear) tagSearchClear.style.display = 'none';
                this.filterTagCheckboxes('');
                document.querySelector('.filter-tab.active')?.classList.remove('active');
                document.querySelector('.filter-tab[data-category="ALL"]')?.classList.add('active');
                this.currentFilter = 'ALL';

                this.advancedFilters = { features:[], hasVideo:false };

                const checkboxes = document.querySelectorAll('#tagFilters input[type="checkbox"],#hasVideoFilter');
                checkboxes.forEach(cb => cb.checked = false);

                this.filterAndDisplayTools();
                this.updateFilterCount();
            }

            resetToDefaults() {
                this.clearAllFilters();
                const sortFilter = document.getElementById('sortFilter');
                if (sortFilter) sortFilter.value = 'name';
                this.currentSort = 'name';

                document.querySelectorAll('.view-option').forEach(opt => opt.classList.remove('active'));
                document.querySelector('.view-option[data-view="grid"]')?.classList.add('active');
                this.currentView = 'grid';

                const groupByFilter = document.getElementById('groupByFilter');
                if (groupByFilter) groupByFilter.value = 'category';
                this.groupByCategory = true;

                this.applyViewStyles();
                this.filterAndDisplayTools();
            }

            updateFilterCount() {
                const { features, hasVideo } = this.advancedFilters;
                let count = 0;
                count += features.length;
                if (hasVideo) count++;
                const el = document.getElementById('filterCount');
                if (el) el.textContent = count > 0 ? `(${count})` : '';
            }
        }

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, {
            passive: false
        });
    </script>
</body>

</html>
